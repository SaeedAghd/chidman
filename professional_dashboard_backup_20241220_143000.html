{% extends 'store_analysis/base.html' %}
{% load static %}

{% block title %}ویزارد تحلیل حرفه‌ای فروشگاه - چیدمانو{% endblock %}
<!-- Cache Buster: {{ "now"|date:"Y-m-d H:i:s" }} -->

{% block extra_css %}
<style>
/* Clean Professional Wizard Styles */
.wizard-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 2rem 0;
    font-family: 'Vazirmatn', 'Tahoma', sans-serif;
}

.wizard-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    overflow: hidden;
    margin: 0 auto;
    max-width: 1200px;
    position: relative;
}

.wizard-header {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    padding: 2rem;
    text-align: center;
    position: relative;
}

.wizard-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.wizard-header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* Enhanced Stepper */
.wizard-stepper {
    background: #f8f9fa;
    padding: 2rem;
    border-bottom: 1px solid #e9ecef;
}

.stepper-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    max-width: 800px;
    margin: 0 auto;
}

.stepper-wrapper::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #e9ecef 0%, #667eea 50%, #e9ecef 100%);
    z-index: 1;
    border-radius: 2px;
}

.step-item {
    position: relative;
    z-index: 2;
    background: white;
    border: 3px solid #e9ecef;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #6c757d;
    transition: all 0.4s ease;
    cursor: pointer;
}

.step-item.active {
    border-color: #667eea;
    background: #667eea;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.step-item.completed {
    border-color: #28a745;
    background: #28a745;
    color: white;
    transform: scale(1.05);
}

.step-item.completed::after {
    content: '✓';
    position: absolute;
    font-size: 1.2rem;
    font-weight: bold;
}

.step-label {
    position: absolute;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    color: #6c757d;
    white-space: nowrap;
    text-align: center;
    font-weight: 600;
    max-width: 100px;
}

.step-item.active .step-label {
    color: #667eea;
    font-weight: 700;
}

.step-item.completed .step-label {
    color: #28a745;
}

/* Progress Bar */
.progress-section {
    background: white;
    padding: 1rem 2rem;
    border-bottom: 1px solid #e9ecef;
}

.progress-wrapper {
    max-width: 600px;
    margin: 0 auto;
}

.progress-bar-container {
    height: 8px;
    border-radius: 10px;
    background: #e9ecef;
    overflow: hidden;
    position: relative;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: width 0.6s ease;
    border-radius: 10px;
}

.progress-text {
    text-align: center;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 600;
}

/* Form Content */
.wizard-content {
    padding: 3rem;
    min-height: 600px;
}

/* Fix floating form fields */
.form-field {
    position: relative !important;
    clear: both !important;
    margin-bottom: 1.5rem !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 1 !important;
    overflow: hidden !important;
}

.form-field.full-width {
    grid-column: 1 / -1;
    width: 100% !important;
    float: none !important;
    clear: both !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1 !important;
    margin-bottom: 1.5rem !important;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
    clear: both;
    overflow: hidden;
}

.wizard-step {
    display: none;
}

.wizard-step.active {
    display: block !important;
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Normal wizard step behavior */

@keyframes slideIn {
    from { 
        opacity: 0; 
        transform: translateX(30px); 
    }
    to { 
        opacity: 1; 
        transform: translateX(0); 
    }
}

.step-title {
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1rem;
    text-align: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.step-description {
    color: #6c757d;
    text-align: center;
    margin-bottom: 2rem;
    font-size: 1.1rem;
    line-height: 1.6;
}

/* Enhanced Form Fields - International Standards */
.form-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

.form-section {
    background: #ffffff;
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 3rem;
    border: 1px solid #e9ecef;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    overflow: visible !important;
    clear: both !important;
    position: relative !important;
    min-height: 200px;
}

.form-section:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
}

.section-header {
    display: flex;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f8f9fa;
}

.section-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 1rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.section-icon i {
    font-size: 1.5rem;
    color: white;
}

.section-info {
    flex: 1;
}

.section-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: #2c3e50;
    margin: 0 0 0.5rem 0;
    line-height: 1.3;
}

.section-subtitle {
    font-size: 0.95rem;
    color: #6c757d;
    margin: 0;
    font-weight: 400;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
}

.form-field {
    position: relative;
}

.form-field.full-width {
    grid-column: 1 / -1;
}

.form-label {
    display: flex;
    align-items: center;
    font-size: 0.95rem;
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.75rem;
    line-height: 1.4;
}

.form-label i {
    margin-left: 0.5rem;
    color: #667eea;
    font-size: 0.9rem;
    width: 16px;
    text-align: center;
}

.form-label.required-field::after {
    content: '*';
    color: #dc3545;
    margin-right: 0.25rem;
    font-weight: 700;
}

/* AI Explanation Section */
.ai-explanation {
    margin: 2rem 0;
}

.explanation-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 2rem;
    color: white;
    display: flex;
    align-items: flex-start;
    gap: 1.5rem;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.explanation-icon {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.explanation-icon i {
    font-size: 1.5rem;
    color: white;
}

.explanation-content h4 {
    font-size: 1.2rem;
    font-weight: 700;
    margin: 0 0 1rem 0;
    color: white;
}

.explanation-content p {
    font-size: 1rem;
    margin: 0 0 1rem 0;
    opacity: 0.9;
    line-height: 1.6;
}

.explanation-content ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.explanation-content li {
    font-size: 0.95rem;
    margin-bottom: 0.5rem;
    padding-right: 1rem;
    opacity: 0.9;
    line-height: 1.5;
}

.form-text {
    display: block;
    font-size: 0.8rem;
    color: #6c757d;
    margin-top: 0.5rem;
    font-style: italic;
}

/* Required vs Optional Photos Sections */
.required-photos-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
    border-radius: 15px;
    border-left: 5px solid #dc3545;
}

.optional-photos-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f0fff4 0%, #e6ffe6 100%);
    border-radius: 15px;
    border-left: 5px solid #28a745;
}

.required-photos-section .section-subtitle {
    color: #dc3545;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.optional-photos-section .section-subtitle {
    color: #28a745;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.text-danger {
    color: #dc3545 !important;
}

.text-success {
    color: #28a745 !important;
}

/* Design & Decoration Specific Styles */
.window-display-section {
    background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    border-left: 5px solid #ff9800;
}

.window-display-section .section-title {
    color: #e65100;
}

.color-analysis-explanation,
.window-display-explanation {
    margin: 1.5rem 0;
}

.color-analysis-explanation .explanation-card {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-left: 5px solid #2196f3;
}

.window-display-explanation .explanation-card {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    border-left: 5px solid #ff9800;
}

/* Color Input Styling */
input[type="text"][pattern*="HEX"] {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    text-transform: uppercase;
}

input[type="text"][pattern*="HEX"]:valid {
    border-color: #28a745;
    box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}

input[type="text"][pattern*="HEX"]:invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

/* Color Preview */
.color-preview {
    display: inline-block;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin-left: 10px;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* Customer Behavior Specific Styles */
.customer-behavior-explanation,
.video-analysis-explanation {
    margin: 1.5rem 0;
    clear: both;
    overflow: hidden;
}

/* Fix floating issues in customer behavior sections */
.form-section .form-field {
    float: none;
    clear: both;
    width: 100%;
    margin-bottom: 1.5rem;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.form-section .form-field.full-width {
    width: 100%;
    float: none;
    clear: both;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Ensure form controls are visible */
.form-section input,
.form-section select,
.form-section textarea {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    position: relative !important;
    z-index: 1 !important;
    margin-bottom: 1rem !important;
    clear: both !important;
    float: none !important;
    box-sizing: border-box !important;
}

/* Prevent overlapping and floating issues */
.form-section {
    overflow: visible !important;
    position: relative !important;
}

.form-section * {
    box-sizing: border-box !important;
}

/* Force visibility for all form elements */
.wizard-step.active input,
.wizard-step.active select,
.wizard-step.active textarea,
.wizard-step.active .form-control,
.wizard-step.active .form-field {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* ULTIMATE FIX - Reset everything except dropdowns */
.wizard-step[data-step="4"] *:not(select):not(option) {
    position: static !important;
    float: none !important;
    clear: both !important;
}

.wizard-step[data-step="4"] .form-field {
    margin: 2rem 0 !important;
    padding: 0 !important;
    display: block !important;
    width: 100% !important;
    position: relative !important;
}

.wizard-step[data-step="4"] .form-field label {
    display: block !important;
    margin-bottom: 0.5rem !important;
    position: static !important;
    float: none !important;
}

.wizard-step[data-step="4"] .form-field input,
.wizard-step[data-step="4"] .form-field select,
.wizard-step[data-step="4"] .form-field textarea {
    display: block !important;
    width: 100% !important;
    position: static !important;
    float: none !important;
    clear: both !important;
    margin: 0 !important;
    padding: 1rem !important;
    border: 2px solid #e9ecef !important;
    border-radius: 10px !important;
    background: white !important;
    box-sizing: border-box !important;
}

/* Fix floating text specifically */
.wizard-step[data-step="4"] .form-field small {
    display: block !important;
    margin-top: 0.5rem !important;
    position: static !important;
    float: none !important;
}

/* Form input wrapper - LIST STYLE CHECKBOX */
.form-input-wrapper {
    position: relative !important;
    display: block !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    clear: both !important;
    overflow: visible !important;
    min-height: auto !important;
    z-index: 1000 !important;
    background: transparent !important;
    border: none !important;
    border-radius: 0 !important;
}

/* Style checkboxes as list items */
.form-input-wrapper .form-check {
    display: flex !important;
    align-items: center !important;
    margin-bottom: 0.75rem !important;
    padding: 0.75rem 1rem !important;
    background: white !important;
    border: 1px solid #e9ecef !important;
    border-radius: 8px !important;
    position: relative !important;
    clear: both !important;
    overflow: hidden !important;
    transition: all 0.3s ease !important;
    cursor: pointer !important;
}

.form-input-wrapper .form-check:hover {
    border-color: #667eea !important;
    background: #f8f9ff !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15) !important;
}

.form-input-wrapper .form-check-input {
    position: relative !important;
    float: none !important;
    margin: 0 0.75rem 0 0 !important;
    clear: none !important;
    width: 1.2rem !important;
    height: 1.2rem !important;
    accent-color: #28a745 !important;
    cursor: pointer !important;
}

.form-input-wrapper .form-check-label {
    display: flex !important;
    align-items: center !important;
    position: relative !important;
    float: none !important;
    clear: none !important;
    margin: 0 !important;
    padding: 0 !important;
    width: auto !important;
    overflow: visible !important;
    text-overflow: unset !important;
    white-space: normal !important;
    font-size: 1rem !important;
    color: #495057 !important;
    cursor: pointer !important;
    flex: 1 !important;
}

/* Add checkmark icon for selected items */
.form-input-wrapper .form-check-input:checked + .form-check-label::before {
    content: "✅ " !important;
    margin-left: 0.5rem !important;
    font-size: 1rem !important;
}

/* Specific checkbox fixes for step 4 - LIST STYLE */
.wizard-step[data-step="4"] .form-check {
    display: flex !important;
    align-items: center !important;
    margin-bottom: 0.75rem !important;
    padding: 0.75rem 1rem !important;
    background: white !important;
    border: 1px solid #e9ecef !important;
    border-radius: 8px !important;
    position: relative !important;
    clear: both !important;
    overflow: hidden !important;
    width: 100% !important;
    box-sizing: border-box !important;
    transition: all 0.3s ease !important;
    cursor: pointer !important;
}

.wizard-step[data-step="4"] .form-check:hover {
    border-color: #667eea !important;
    background: #f8f9ff !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15) !important;
}

.wizard-step[data-step="4"] .form-check-input {
    position: relative !important;
    float: none !important;
    margin: 0 0.75rem 0 0 !important;
    clear: none !important;
    width: 1.2rem !important;
    height: 1.2rem !important;
    accent-color: #28a745 !important;
    cursor: pointer !important;
}

.wizard-step[data-step="4"] .form-check-label {
    display: flex !important;
    align-items: center !important;
    position: relative !important;
    float: none !important;
    clear: none !important;
    margin: 0 !important;
    padding: 0 !important;
    width: auto !important;
    overflow: visible !important;
    text-overflow: unset !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    font-size: 1rem !important;
    color: #495057 !important;
    cursor: pointer !important;
    flex: 1 !important;
}

/* Add checkmark for selected items in step 4 */
.wizard-step[data-step="4"] .form-check-input:checked + .form-check-label::before {
    content: "✅ " !important;
    margin-left: 0.5rem !important;
    font-size: 1rem !important;
}

/* FORCE OVERRIDE - ULTIMATE FIX */
#id_stopping_points,
#id_high_traffic_areas {
    display: block !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    background: transparent !important;
    border: none !important;
}

#id_stopping_points .form-check,
#id_high_traffic_areas .form-check {
    display: flex !important;
    align-items: center !important;
    margin-bottom: 0.75rem !important;
    padding: 0.75rem 1rem !important;
    background: white !important;
    border: 1px solid #e9ecef !important;
    border-radius: 8px !important;
    position: relative !important;
    clear: both !important;
    overflow: hidden !important;
    width: 100% !important;
    box-sizing: border-box !important;
    transition: all 0.3s ease !important;
    cursor: pointer !important;
}

#id_stopping_points .form-check:hover,
#id_high_traffic_areas .form-check:hover {
    border-color: #667eea !important;
    background: #f8f9ff !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15) !important;
}

#id_stopping_points .form-check-input,
#id_high_traffic_areas .form-check-input {
    position: relative !important;
    float: none !important;
    margin: 0 0.75rem 0 0 !important;
    clear: none !important;
    width: 1.2rem !important;
    height: 1.2rem !important;
    accent-color: #28a745 !important;
    cursor: pointer !important;
}

#id_stopping_points .form-check-label,
#id_high_traffic_areas .form-check-label {
    display: flex !important;
    align-items: center !important;
    position: relative !important;
    float: none !important;
    clear: none !important;
    margin: 0 !important;
    padding: 0 !important;
    width: auto !important;
    overflow: visible !important;
    text-overflow: unset !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    font-size: 1rem !important;
    color: #495057 !important;
    cursor: pointer !important;
    flex: 1 !important;
}

/* Fix overlapping form fields - CRITICAL FIX */
.form-field {
    position: relative !important;
    z-index: 10 !important;
    margin-bottom: 2rem !important;
    clear: both !important;
    overflow: visible !important;
    display: block !important;
    width: 100% !important;
}

.form-field.full-width {
    width: 100% !important;
    clear: both !important;
    margin-bottom: 2rem !important;
    position: relative !important;
    z-index: 10 !important;
    display: block !important;
}

/* Fix floating text issue */
.form-field label {
    display: block !important;
    margin-bottom: 0.5rem !important;
    position: relative !important;
    z-index: 10 !important;
}

.form-field input,
.form-field select,
.form-field textarea {
    position: relative !important;
    z-index: 10 !important;
    margin-top: 0.5rem !important;
    margin-bottom: 0 !important;
}

.customer-behavior-explanation .explanation-card {
    background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
    border-left: 5px solid #4caf50;
}

.video-analysis-explanation .explanation-card {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    border-left: 5px solid #ff9800;
}

/* Checkbox Styling for Multiple Choice Fields */
.form-check-input {
    margin-right: 0.5rem;
}

.form-check-label {
    margin-bottom: 0.5rem;
    padding-left: 0.5rem;
    cursor: pointer;
}

/* Video Upload Styling */
input[type="file"][accept*="video"] {
    border: 2px dashed #007bff;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

input[type="file"][accept*="video"]:hover {
    border-color: #0056b3;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
}

/* ===== WORLD-CLASS SMART CATEGORY SELECTOR ===== */
.smart-category-selector {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

.smart-category-selector::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
}

.category-search-box {
    position: relative;
    margin-bottom: 2rem;
}

.category-search-box input {
    width: 100%;
    padding: 1rem 3rem 1rem 1.5rem;
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    font-size: 1.1rem;
    background: #ffffff;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.category-search-box input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
}

.category-search-box i {
    position: absolute;
    right: 1.5rem;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
    font-size: 1.2rem;
}

.category-grid-modern {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.category-item {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 2px solid transparent;
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.category-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.category-item:hover {
    transform: translateY(-4px);
    border-color: #667eea;
    box-shadow: 0 20px 40px rgba(102, 126, 234, 0.15);
}

.category-item:hover::before {
    opacity: 1;
}

.category-item.selected {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    transform: translateY(-2px);
}

.category-icon {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    flex-shrink: 0;
    box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
}

.category-info {
    flex: 1;
    z-index: 1;
    position: relative;
}

.category-info h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1.2rem;
    font-weight: 600;
    color: #1e293b;
}

.category-info p {
    margin: 0;
    color: #64748b;
    font-size: 0.9rem;
    line-height: 1.4;
}

.category-checkbox {
    z-index: 1;
    position: relative;
}

.category-checkbox input[type="checkbox"] {
    display: none;
}

.category-checkbox label {
    width: 24px;
    height: 24px;
    border: 2px solid #cbd5e1;
    border-radius: 6px;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
    background: white;
}

.category-checkbox input[type="checkbox"]:checked + label {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-color: #667eea;
    transform: scale(1.1);
}

.category-checkbox input[type="checkbox"]:checked + label .checkmark {
    opacity: 1;
    transform: scale(1);
}

.checkmark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    color: white;
    font-size: 12px;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.selected-categories-summary {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #cbd5e1;
}

.selected-categories-summary h4 {
    margin: 0 0 1rem 0;
    color: #1e293b;
    font-size: 1.1rem;
    font-weight: 600;
}

.selected-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.selected-tags .no-selection {
    color: #94a3b8;
    font-style: italic;
}

.category-tag {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 6px rgba(102, 126, 234, 0.2);
    animation: tagAppear 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.category-tag .remove-tag {
    cursor: pointer;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    transition: all 0.2s ease;
}

.category-tag .remove-tag:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

@keyframes tagAppear {
    0% {
        opacity: 0;
        transform: scale(0.8) translateY(10px);
    }
    100% {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

@keyframes ripple {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .category-grid-modern {
        grid-template-columns: 1fr;
    }
    
    .category-item {
        padding: 1rem;
    }
    
    .category-icon {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }
}

/* Responsive Design - International Standards */
@media (max-width: 768px) {
    .form-container {
        padding: 0 0.5rem;
    }
    
    .form-section {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .section-header {
        flex-direction: column;
        text-align: center;
        margin-bottom: 1.5rem;
    }
    
    .section-icon {
        margin: 0 0 1rem 0;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .form-field.full-width {
        grid-column: 1;
    }
    
    .section-title {
        font-size: 1.2rem;
    }
    
    .section-subtitle {
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .form-section {
        padding: 1rem;
        border-radius: 15px;
    }
    
    .section-icon {
        width: 50px;
        height: 50px;
    }
    
    .section-icon i {
        font-size: 1.2rem;
    }
    
    .form-label {
        font-size: 0.9rem;
    }
    
    .form-label i {
        font-size: 0.8rem;
    }
    
    .explanation-card {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
    }
    
    .explanation-icon {
        margin: 0 auto 1rem auto;
    }
    
    .explanation-content h4 {
        font-size: 1.1rem;
    }
    
    .explanation-content p {
        font-size: 0.9rem;
    }
    
    .explanation-content li {
        font-size: 0.85rem;
    }
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
    display: block;
    font-size: 1rem;
}

.required-field::after {
    content: " *";
    color: #e53e3e;
    font-weight: bold;
}

.form-control {
    border: 2px solid #e9ecef !important;
    border-radius: 10px !important;
    padding: 0.75rem 1rem !important;
    font-size: 1rem !important;
    transition: all 0.3s ease !important;
    width: 100% !important;
    background: white !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1 !important;
    margin-bottom: 1rem !important;
    clear: both !important;
    float: none !important;
    box-sizing: border-box !important;
}

.form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    outline: none;
}

/* Checkbox and Radio Styles */
.form-check {
    margin-bottom: 1rem;
    padding: 0.75rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-check:hover {
    border-color: #667eea;
    background: #f8f9ff;
}

.form-check-input {
    width: 1.2rem;
    height: 1.2rem;
    margin-left: 0.5rem;
    accent-color: #667eea;
}

.form-check-label {
    font-weight: 500;
    color: #495057;
    cursor: pointer;
    margin: 0;
}

/* File Upload Enhanced */
.file-upload-section {
    background: white;
    border: 2px dashed #dee2e6;
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    margin-bottom: 1rem;
}

.file-upload-section:hover {
    border-color: #667eea;
    background: #f8f9ff;
    transform: translateY(-2px);
}

.file-upload-section i {
    font-size: 3rem;
    color: #6c757d;
    margin-bottom: 1rem;
}

.file-upload-section p {
    font-size: 1.1rem;
    color: #495057;
    margin-bottom: 0.5rem;
}

.file-upload-section small {
    color: #6c757d;
}

/* Navigation Buttons */
.wizard-navigation {
    background: #f8f9fa;
    padding: 2rem;
    border-top: 1px solid #e9ecef;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    bottom: 0;
    z-index: 100;
}

.btn {
    padding: 0.75rem 2rem;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #218838;
    transform: translateY(-2px);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

/* Validation Styles */
.is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
}

.invalid-feedback {
    color: #dc3545;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: block;
}

/* Loading and Success States */
.wizard-loading {
    display: none;
    text-align: center;
    padding: 3rem;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.wizard-success {
    display: none;
    text-align: center;
    padding: 3rem;
}

.success-icon {
    font-size: 4rem;
    color: #28a745;
    margin-bottom: 1rem;
    animation: bounce 0.6s ease;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .wizard-card {
        margin: 1rem;
        border-radius: 15px;
    }
    
    .wizard-header h1 {
        font-size: 2rem;
    }
    
    .stepper-wrapper {
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .step-item {
        width: 50px;
        height: 50px;
    }
    
    .step-label {
        font-size: 0.7rem;
        max-width: 80px;
    }
    
    .wizard-navigation {
        flex-direction: column;
        gap: 1rem;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
    
    .wizard-content {
        padding: 2rem 1rem;
    }
}

/* MODERN STEP 5 FORM STYLES - INTERNATIONAL STANDARDS */

/* Store Type Info */
.store-type-info {
    margin: 1.5rem 0;
}

.info-card {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border: 1px solid #90caf9;
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    transition: all 0.3s ease;
}

.info-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(33, 150, 243, 0.15);
}

.info-card i {
    color: #1976d2;
    font-size: 1.5rem;
    margin-top: 0.25rem;
    flex-shrink: 0;
}

.info-content h4 {
    color: #1565c0;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.info-content p {
    color: #424242;
    font-size: 0.9rem;
    margin: 0;
    line-height: 1.5;
}

.info-content span {
    font-weight: 600;
    color: #1976d2;
}

/* Product Categories Container */
.product-categories-container {
    margin-top: 2rem;
}

.category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-top: 1.5rem;
}

.category-group {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    padding: 2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    display: none; /* Initially hidden, will be shown based on store type */
}

.category-group::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
}

.category-group:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border-color: #667eea;
}

.category-group-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.category-group-title i {
    color: #667eea;
    font-size: 1.4rem;
}

.category-options {
    display: grid;
    gap: 1rem;
}

/* Modern Checkbox Styles */
.modern-checkbox {
    position: relative;
    margin-bottom: 0.75rem;
}

.modern-checkbox input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.modern-checkbox label {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: #ffffff;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.modern-checkbox label::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 0;
}

.modern-checkbox label:hover {
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
}

.modern-checkbox input[type="checkbox"]:checked + label {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    color: #2d3748;
}

.modern-checkbox input[type="checkbox"]:checked + label::before {
    opacity: 0.1;
}

.modern-checkbox input[type="checkbox"]:checked + label .checkmark {
    background: #667eea;
    border-color: #667eea;
}

.modern-checkbox input[type="checkbox"]:checked + label .checkmark::after {
    opacity: 1;
    transform: scale(1);
}

.checkmark {
    position: relative;
    width: 24px;
    height: 24px;
    background: #ffffff;
    border: 2px solid #cbd5e0;
    border-radius: 6px;
    transition: all 0.3s ease;
    flex-shrink: 0;
    z-index: 1;
}

.checkmark::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 2px;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg) scale(0);
    opacity: 0;
    transition: all 0.3s ease;
}

.label-text {
    font-weight: 600;
    color: #2d3748;
    font-size: 1rem;
    z-index: 1;
    position: relative;
}

.label-desc {
    font-size: 0.875rem;
    color: #718096;
    margin-top: 0.25rem;
    z-index: 1;
    position: relative;
}

/* Textarea Container with Counter */
.textarea-container {
    position: relative;
}

.textarea-counter {
    position: absolute;
    bottom: 10px;
    right: 15px;
    font-size: 0.75rem;
    color: #a0aec0;
    background: rgba(255, 255, 255, 0.9);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    backdrop-filter: blur(10px);
}

.char-count {
    font-weight: 600;
    color: #667eea;
}

/* Input Group Styles */
.input-group {
    display: flex;
    align-items: stretch;
}

.input-group-append {
    display: flex;
    align-items: center;
}

.input-group-text {
    background: #f7fafc;
    border: 1px solid #e2e8f0;
    border-left: none;
    padding: 0.75rem 1rem;
    color: #4a5568;
    font-weight: 500;
    border-radius: 0 12px 12px 0;
}

/* File Upload Styles */
.file-upload-container {
    margin-top: 1rem;
}

.file-upload-area {
    border: 2px dashed #cbd5e0;
    border-radius: 16px;
    padding: 3rem 2rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
}

.file-upload-area:hover {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    transform: translateY(-2px);
}

.file-upload-area.dragover {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    transform: scale(1.02);
}

.file-upload-content i {
    font-size: 3rem;
    color: #667eea;
    margin-bottom: 1rem;
}

.file-upload-content h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
}

.file-upload-content p {
    color: #718096;
    margin-bottom: 1.5rem;
}

.supported-formats {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.format-tag {
    background: #667eea;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
}

.file-info {
    margin-top: 1rem;
    padding: 1rem;
    background: #f7fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.file-details {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.file-details i {
    font-size: 1.5rem;
    color: #48bb78;
}

.file-meta {
    flex: 1;
}

.file-name {
    display: block;
    font-weight: 600;
    color: #2d3748;
}

.file-size {
    display: block;
    font-size: 0.875rem;
    color: #718096;
}

.remove-file {
    background: #fed7d7;
    color: #c53030;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.remove-file:hover {
    background: #feb2b2;
    transform: scale(1.1);
}

/* STEP 6 & 7 PROFESSIONAL STYLES - FIGMA STANDARDS */

/* Security Options (Step 6) */
.security-options-container {
    margin-top: 2rem;
}

.security-option-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.security-option-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
}

.security-option-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border-color: #667eea;
}

.security-option-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.security-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.security-info {
    flex: 1;
}

.security-info h4 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.5rem;
}

.security-info p {
    color: #718096;
    font-size: 0.9rem;
    margin: 0;
}

/* Modern Toggle Switch */
.modern-toggle {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 32px;
}

.modern-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #cbd5e0;
    transition: 0.4s;
    border-radius: 32px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 24px;
    width: 24px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

input:checked + .toggle-slider {
    background-color: #667eea;
}

input:checked + .toggle-slider:before {
    transform: translateX(28px);
}

.security-details {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e2e8f0;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Goals Container (Step 7) */
.goals-container {
    margin-top: 2rem;
}

.goals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.goal-category {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    padding: 2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.goal-category::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
}

.goal-category:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border-color: #667eea;
}

.goal-category-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.goal-category-title i {
    color: #667eea;
    font-size: 1.4rem;
}

.goal-options {
    display: grid;
    gap: 1rem;
}

/* Report Options (Step 7) */
.report-options-container {
    margin-top: 2rem;
}

.report-categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.report-category {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    padding: 2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.report-category::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
}

.report-category:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border-color: #667eea;
}

.report-category-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.report-category-title i {
    color: #667eea;
    font-size: 1.4rem;
}

.report-options {
    display: grid;
    gap: 1rem;
}

/* Responsive Design for Steps 5, 6, 7 */
@media (max-width: 768px) {
    .category-grid,
    .goals-grid,
    .report-categories-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .category-group,
    .goal-category,
    .report-category,
    .security-option-card {
        padding: 1.5rem;
    }
    
    .modern-checkbox label {
        padding: 0.75rem;
    }
    
    .file-upload-area {
        padding: 2rem 1rem;
    }
    
    .supported-formats {
        gap: 0.25rem;
    }
    
    .format-tag {
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
    }
    
    .security-option-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .security-icon {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }
}

/* WORLD-CLASS PROFESSIONAL CHECKBOX LAYOUT - INTERNATIONAL STANDARD */
#id_stopping_points,
#id_high_traffic_areas,
#id_product_categories,
#id_optimization_goals,
#id_report_format {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)) !important;
    gap: 1.5rem !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 2rem !important;
    background: 
        linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%),
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%) !important;
    border: 1px solid rgba(226, 232, 240, 0.8) !important;
    border-radius: 24px !important;
    box-sizing: border-box !important;
    min-height: 400px !important;
    position: relative !important;
    overflow: hidden !important;
    box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.05),
        0 4px 6px rgba(0, 0, 0, 0.05),
        0 10px 15px rgba(0, 0, 0, 0.05),
        0 20px 25px rgba(0, 0, 0, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.8) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

#id_stopping_points::before,
#id_high_traffic_areas::before,
#id_product_categories::before,
#id_optimization_goals::before,
#id_report_format::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 4px !important;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%) !important;
    border-radius: 20px 20px 0 0 !important;
}

#id_stopping_points:hover,
#id_high_traffic_areas:hover,
#id_product_categories:hover,
#id_optimization_goals:hover,
#id_report_format:hover {
    transform: translateY(-2px) !important;
    box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 0 0 1px rgba(102, 126, 234, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}

/* PREMIUM CHECKBOX CARDS */
#id_stopping_points > div,
#id_high_traffic_areas > div,
#id_product_categories > div,
#id_optimization_goals > div,
#id_report_format > div {
    display: flex !important;
    align-items: center !important;
    margin: 0 !important;
    padding: 1.5rem !important;
    background: 
        linear-gradient(135deg, #ffffff 0%, #fefefe 50%, #f8fafc 100%),
        radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.03) 0%, transparent 50%) !important;
    border: 1px solid rgba(226, 232, 240, 0.6) !important;
    border-radius: 16px !important;
    position: relative !important;
    clear: both !important;
    overflow: hidden !important;
    width: 100% !important;
    box-sizing: border-box !important;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
    cursor: pointer !important;
    min-height: 70px !important;
    box-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.05),
        0 2px 4px rgba(0, 0, 0, 0.05),
        0 4px 8px rgba(0, 0, 0, 0.05) !important;
    backdrop-filter: blur(10px) saturate(150%) !important;
}

#id_stopping_points > div::before,
#id_high_traffic_areas > div::before,
#id_product_categories > div::before,
#id_optimization_goals > div::before,
#id_report_format > div::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%) !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
    border-radius: 16px !important;
    z-index: 0 !important;
}

#id_stopping_points > div:hover,
#id_high_traffic_areas > div:hover,
#id_product_categories > div:hover,
#id_optimization_goals > div:hover,
#id_report_format > div:hover {
    border-color: rgba(59, 130, 246, 0.4) !important;
    background: 
        linear-gradient(135deg, #ffffff 0%, #f0f9ff 50%, #e0f2fe 100%),
        radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 50%) !important;
    box-shadow: 
        0 4px 6px rgba(0, 0, 0, 0.05),
        0 8px 15px rgba(0, 0, 0, 0.05),
        0 16px 25px rgba(0, 0, 0, 0.05),
        0 0 0 1px rgba(59, 130, 246, 0.1) !important;
    transform: translateY(-2px) scale(1.01) !important;
}

#id_stopping_points > div:hover::before,
#id_high_traffic_areas > div:hover::before,
#id_product_categories > div:hover::before,
#id_optimization_goals > div:hover::before,
#id_report_format > div:hover::before {
    opacity: 1 !important;
}

/* PREMIUM LABEL STYLING */
#id_stopping_points > div > label,
#id_high_traffic_areas > div > label,
#id_product_categories > div > label,
#id_optimization_goals > div > label,
#id_report_format > div > label {
    display: flex !important;
    align-items: center !important;
    margin: 0 !important;
    padding: 0 !important;
    font-size: 15px !important;
    font-weight: 600 !important;
    color: #1e293b !important;
    cursor: pointer !important;
    line-height: 1.5 !important;
    width: 100% !important;
    min-height: 50px !important;
    position: relative !important;
    z-index: 1 !important;
    letter-spacing: 0.025em !important;
    transition: all 0.3s ease !important;
}

#id_stopping_points > div:hover > label,
#id_high_traffic_areas > div:hover > label,
#id_product_categories > div:hover > label,
#id_optimization_goals > div:hover > label,
#id_report_format > div:hover > label {
    color: #0f172a !important;
    transform: translateX(2px) !important;
}

/* PREMIUM CHECKBOX INPUT STYLING */
#id_stopping_points > div > label > input,
#id_high_traffic_areas > div > label > input,
#id_product_categories > div > label > input,
#id_optimization_goals > div > label > input,
#id_report_format > div > label > input {
    width: 20px !important;
    height: 20px !important;
    margin: 0 12px 0 0 !important;
    accent-color: #3b82f6 !important;
    cursor: pointer !important;
    flex-shrink: 0 !important;
    border-radius: 6px !important;
    border: 1.5px solid #d1d5db !important;
    background: #ffffff !important;
    transition: all 0.2s ease !important;
    position: relative !important;
    z-index: 2 !important;
    box-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.05),
        0 0 0 1px rgba(255, 255, 255, 0.8) !important;
}

#id_stopping_points > div:hover > label > input,
#id_high_traffic_areas > div:hover > label > input,
#id_product_categories > div:hover > label > input,
#id_optimization_goals > div:hover > label > input,
#id_report_format > div:hover > label > input {
    border-color: #3b82f6 !important;
    box-shadow: 
        0 2px 4px rgba(59, 130, 246, 0.15),
        0 0 0 3px rgba(59, 130, 246, 0.1) !important;
    transform: scale(1.05) !important;
}

/* Add checkmark for selected items */
#id_stopping_points > div > label > input:checked + *,
#id_high_traffic_areas > div > label > input:checked + *,
#id_product_categories > div > label > input:checked + *,
#id_optimization_goals > div > label > input:checked + *,
#id_report_format > div > label > input:checked + * {
    position: relative !important;
}

#id_stopping_points > div > label > input:checked + *::after,
#id_high_traffic_areas > div > label > input:checked + *::after,
#id_product_categories > div > label > input:checked + *::after,
#id_optimization_goals > div > label > input:checked + *::after,
#id_report_format > div > label > input:checked + *::after {
    content: "✅" !important;
    position: absolute !important;
    right: 12px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    font-size: 16px !important;
}

/* PREMIUM SELECTED STATE STYLING */
#id_stopping_points > div > label > input:checked,
#id_high_traffic_areas > div > label > input:checked,
#id_product_categories > div > label > input:checked,
#id_optimization_goals > div > label > input:checked,
#id_report_format > div > label > input:checked {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
    border-color: #3b82f6 !important;
    box-shadow: 
        0 2px 8px rgba(59, 130, 246, 0.3),
        0 0 0 1px rgba(59, 130, 246, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
    transform: scale(1.02) !important;
}

/* PREMIUM SELECTED CONTAINER STYLING */
#id_stopping_points > div:has(input:checked),
#id_high_traffic_areas > div:has(input:checked),
#id_product_categories > div:has(input:checked),
#id_optimization_goals > div:has(input:checked),
#id_report_format > div:has(input:checked) {
    border-color: rgba(59, 130, 246, 0.4) !important;
    background: 
        linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(29, 78, 216, 0.05) 100%),
        radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 50%) !important;
    box-shadow: 
        0 4px 6px rgba(0, 0, 0, 0.05),
        0 8px 15px rgba(0, 0, 0, 0.05),
        0 0 0 1px rgba(59, 130, 246, 0.15) !important;
    transform: translateY(-1px) !important;
}

#id_stopping_points > div:has(input:checked)::before,
#id_high_traffic_areas > div:has(input:checked)::before,
#id_product_categories > div:has(input:checked)::before,
#id_optimization_goals > div:has(input:checked)::before,
#id_report_format > div:has(input:checked)::before {
    opacity: 1 !important;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%) !important;
}

/* PREMIUM CHECKMARK STYLING */
#id_stopping_points > div:has(input:checked)::after,
#id_high_traffic_areas > div:has(input:checked)::after,
#id_product_categories > div:has(input:checked)::after,
#id_optimization_goals > div:has(input:checked)::after,
#id_report_format > div:has(input:checked)::after {
    content: "✓" !important;
    position: absolute !important;
    top: 50% !important;
    right: 1.5rem !important;
    transform: translateY(-50%) !important;
    width: 32px !important;
    height: 32px !important;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    color: white !important;
    font-size: 16px !important;
    font-weight: bold !important;
    box-shadow: 
        0 4px 12px rgba(16, 185, 129, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    animation: checkmarkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
    z-index: 3 !important;
}

@keyframes checkmarkPop {
    0% {
        transform: translateY(-50%) scale(0);
        opacity: 0;
    }
    50% {
        transform: translateY(-50%) scale(1.2);
    }
    100% {
        transform: translateY(-50%) scale(1);
        opacity: 1;
    }
}

/* Add checkmark for selected items */
#id_stopping_points input[type="checkbox"]:checked + label::before,
#id_high_traffic_areas input[type="checkbox"]:checked + label::before {
    content: "✅ " !important;
    margin-left: 0.5rem !important;
    font-size: 1rem !important;
}
</style>
{% endblock %}

{% block content %}
<div class="wizard-container">
    <div class="wizard-card">
        <!-- Header -->
        <div class="wizard-header">
            <h1>ویزارد تحلیل حرفه‌ای فروشگاه</h1>
            <p>بهینه‌سازی چیدمان فروشگاه شما با هوش مصنوعی پیشرفته</p>
        </div>

        <!-- Enhanced Stepper -->
        <div class="wizard-stepper">
            <div class="stepper-wrapper">
                <div class="step-item active" data-step="1">
                    <span>1</span>
                    <div class="step-label">اطلاعات پایه</div>
                </div>
                <div class="step-item" data-step="2">
                    <span>2</span>
                    <div class="step-label">ساختار فیزیکی</div>
                </div>
                <div class="step-item" data-step="3">
                    <span>3</span>
                    <div class="step-label">طراحی و دکوراسیون</div>
                </div>
                <div class="step-item" data-step="4">
                    <span>4</span>
                    <div class="step-label">رفتار مشتری</div>
                </div>
                <div class="step-item" data-step="5">
                    <span>5</span>
                    <div class="step-label">فروش و محصولات</div>
                </div>
                <div class="step-item" data-step="6">
                    <span>6</span>
                    <div class="step-label">امنیت و نظارت</div>
                </div>
                <div class="step-item" data-step="7">
                    <span>7</span>
                    <div class="step-label">اهداف و خروجی</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
            <div class="progress-wrapper">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 14.28%"></div>
                </div>
                <div class="progress-text" id="progressText">گام 1 از 7 - اطلاعات پایه فروشگاه</div>
            </div>
        </div>

        <!-- Form Content -->
        <form method="post" action="{% url 'store_analysis:step7_goals' %}" enctype="multipart/form-data" id="wizardForm">
            {% csrf_token %}
            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
            
            <div class="wizard-content">
                <!-- Step 1: اطلاعات پایه -->
                <div class="wizard-step active" data-step="1">
                    <div class="step-header">
                    <h2 class="step-title">اطلاعات پایه فروشگاه</h2>
                        <p class="step-description">اطلاعات کلی فروشگاه شما برای شروع تحلیل حرفه‌ای</p>
                    </div>
                    
                    <div class="form-container">
                        <!-- بخش 1: اطلاعات اصلی -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-store"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">اطلاعات فروشگاه</h3>
                                    <p class="section-subtitle">نام، نوع و مساحت فروشگاه</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field full-width">
                                    <label class="form-label required-field">
                                        <i class="fas fa-signature"></i>
                            نام فروشگاه
                        </label>
                        {{ form.store_name }}
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-tags"></i>
                            نوع فروشگاه
                        </label>
                        {{ form.store_type }}
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-ruler-combined"></i>
                                        مساحت (متر مربع)
                        </label>
                        {{ form.store_size }}
                                </div>
                            </div>
                        </div>

                        <!-- بخش 2: موقعیت جغرافیایی -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">موقعیت جغرافیایی</h3>
                                    <p class="section-subtitle">شهر، منطقه و نوع مکان</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-city"></i>
                                        شهر
                                    </label>
                                    {{ form.city }}
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-map-pin"></i>
                                        منطقه
                                    </label>
                                    {{ form.area }}
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-building"></i>
                                        نوع مکان
                                    </label>
                                    {{ form.location_type }}
                                </div>
                            </div>
                        </div>

                        <!-- بخش 3: اطلاعات تکمیلی -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">اطلاعات تکمیلی</h3>
                                    <p class="section-subtitle">سال تأسیس و نیروی کاری</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-calendar-alt"></i>
                                        سال تأسیس
                                    </label>
                                    {{ form.establishment_year }}
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-users"></i>
                                        تعداد نیروی کاری
                                    </label>
                                    {{ form.workforce_count }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: ساختار فیزیکی -->
                <div class="wizard-step" data-step="2">
                    <h2 class="step-title">ساختار فیزیکی فروشگاه</h2>
                    <p class="step-description">اطلاعات مربوط به ساختار و چیدمان فیزیکی فروشگاه</p>
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-ruler-combined"></i>
                            ابعاد فروشگاه
                        </h3>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required-field">طول فروشگاه (متر)</label>
                                {{ form.store_length }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required-field">عرض فروشگاه (متر)</label>
                                {{ form.store_width }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required-field">ارتفاع فروشگاه (متر)</label>
                                {{ form.store_height }}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label required-field">تعداد طبقات</label>
                                {{ form.floor_count }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label required-field">موقعیت انبار</label>
                                {{ form.warehouse_location }}
                            </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-warehouse"></i>
                            اطلاعات انبار
                        </h3>
                    
                    <div class="row">
                        <div class="col-md-4">
                    <div class="form-group">
                                <label class="form-label">طول انبار (متر)</label>
                                {{ form.warehouse_length }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">عرض انبار (متر)</label>
                                {{ form.warehouse_width }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">ارتفاع انبار (متر)</label>
                                {{ form.warehouse_height }}
                            </div>
                    </div>
                </div>

                    </div>
                    
                    <!-- بخش آپلود عکس‌ها -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="section-info">
                                <h3 class="section-title">عکس‌های فروشگاه</h3>
                                <p class="section-subtitle">آپلود عکس‌های مختلف برای تحلیل بهتر هوش مصنوعی</p>
                            </div>
                        </div>
                        
                        <div class="ai-explanation">
                            <div class="explanation-card">
                                <div class="explanation-icon">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <div class="explanation-content">
                                    <h4>چرا عکس‌های متعدد مهم است؟</h4>
                                    <p>هوش مصنوعی با تحلیل عکس‌های مختلف از زاویه‌های گوناگون، می‌تواند:</p>
                                    <ul>
                                        <li>✅ چیدمان و ترتیب محصولات را بهتر درک کند</li>
                                        <li>✅ نقاط قوت و ضعف فضای فروشگاه را شناسایی کند</li>
                                        <li>✅ پیشنهادات بهینه‌سازی دقیق‌تری ارائه دهد</li>
                                        <li>✅ الگوهای رفتاری مشتریان را پیش‌بینی کند</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- عکس‌های اجباری -->
                        <div class="required-photos-section">
                            <h4 class="section-subtitle">
                                <i class="fas fa-camera text-primary"></i>
                                عکس‌های فروشگاه (اختیاری)
                            </h4>
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - نمای کلی
                                    </label>
                                    {{ form.store_photos_1 }}
                                    <small class="form-text">نمای کلی فروشگاه از بیرون یا داخل (اختیاری)</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - راهروهای اصلی
                                    </label>
                                    {{ form.store_photos_2 }}
                                    <small class="form-text">راهروهای اصلی و چیدمان محصولات (اختیاری)</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- عکس‌های اختیاری -->
                        <div class="optional-photos-section">
                            <h4 class="section-subtitle">
                                <i class="fas fa-plus-circle text-success"></i>
                                عکس‌های اختیاری (برای تحلیل بهتر)
                            </h4>
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - صندوق‌های پرداخت
                                    </label>
                                    {{ form.store_photos_3 }}
                                    <small class="form-text">ناحیه صندوق‌ها و انتظار مشتریان</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - بخش‌های خاص
                                    </label>
                                    {{ form.store_photos_4 }}
                                    <small class="form-text">بخش‌های ویژه مثل گوشت، لبنیات</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - زاویه اضافی ۱
                                    </label>
                                    {{ form.store_photos_5 }}
                                    <small class="form-text">زاویه اضافی برای تحلیل بهتر</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - زاویه اضافی ۲
                                    </label>
                                    {{ form.store_photos_6 }}
                                    <small class="form-text">زاویه اضافی برای تحلیل بهتر</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - زاویه اضافی ۳
                                    </label>
                                    {{ form.store_photos_7 }}
                                    <small class="form-text">زاویه اضافی برای تحلیل بهتر</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس فروشگاه - زاویه اضافی ۴
                                    </label>
                                    {{ form.store_photos_8 }}
                                    <small class="form-text">زاویه اضافی برای تحلیل بهتر</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بخش عکس انبار و فایل‌های ساختاری -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <div class="section-info">
                                <h3 class="section-title">عکس انبار و فایل‌های ساختاری</h3>
                                <p class="section-subtitle">اطلاعات تکمیلی برای تحلیل دقیق‌تر</p>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-field">
                                <label class="form-label">
                                    <i class="fas fa-warehouse"></i>
                                    عکس انبار
                                </label>
                                {{ form.warehouse_photos }}
                                <small class="form-text">عکس فضای ذخیره‌سازی و انبار</small>
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label">
                                    <i class="fas fa-file-alt"></i>
                                    فایل‌های ساختاری
                                </label>
                                {{ form.structure_files }}
                                <small class="form-text">پلان، نقشه، یا فایل‌های CAD</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-building"></i>
                            ساختار کلی
                        </h3>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required-field">تعداد ورودی‌ها</label>
                                {{ form.entrance_count }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required-field">تعداد صندوق‌ها</label>
                                {{ form.checkout_count }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required-field">تعداد قفسه‌ها</label>
                                {{ form.shelf_count }}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">ابعاد قفسه‌ها</label>
                                {{ form.shelf_dimensions }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">چیدمان قفسه‌ها</label>
                                {{ form.shelf_layout }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-map-marked-alt"></i>
                            مناطق بلااستفاده
                        </h3>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">مساحت مناطق بلااستفاده</label>
                                {{ form.unused_area_size }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">نوع منطقه بلااستفاده</label>
                                {{ form.unused_area_type }}
                            </div>
                        </div>
                    </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-images"></i>
                            فایل‌های تصویری
                        </h3>


                    <div class="form-group">
                        <label class="form-label">نقشه فروشگاه</label>
                            <div class="file-upload-section" onclick="document.getElementById('id_store_plan').click()">
                            <i class="fas fa-map"></i>
                            <p>برای آپلود نقشه کلیک کنید</p>
                            <small>فرمت‌های مجاز: PDF, JPG, PNG, DWG</small>
                        </div>
                        {{ form.store_plan }}
                        </div>
                    </div>
                </div>

                <!-- Step 3: طراحی و دکوراسیون - تحلیل بصری پیشرفته -->
                <div class="wizard-step" data-step="3">
                    <div class="step-header">
                    <h2 class="step-title">طراحی و دکوراسیون</h2>
                        <p class="step-description">تحلیل بصری پیشرفته برای بهینه‌سازی جذب مشتری</p>
                    </div>
                    
                    <div class="form-container">
                        <!-- بخش 1: سبک طراحی -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">سبک طراحی</h3>
                                    <p class="section-subtitle">هویت بصری و سبک کلی فروشگاه</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field full-width">
                                    <label class="form-label required-field">
                                        <i class="fas fa-paint-brush"></i>
                                        سبک طراحی فعلی
                                    </label>
                        {{ form.design_style }}
                                    <small class="form-text">سبک طراحی بر جذب مشتری و تجربه خرید تأثیر مستقیم دارد</small>
                                </div>
                            </div>
                    </div>

                        <!-- بخش 2: رنگ‌های برند -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-fill-drip"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">رنگ‌های برند</h3>
                                    <p class="section-subtitle">تحلیل دقیق رنگ‌ها با کد HEX</p>
                                </div>
                    </div>

                            <div class="color-analysis-explanation">
                                <div class="explanation-card">
                                    <div class="explanation-icon">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="explanation-content">
                                        <h4>چرا تحلیل رنگ مهم است؟</h4>
                                        <p>هوش مصنوعی با تحلیل رنگ‌ها می‌تواند:</p>
                                        <ul>
                                            <li>✅ تأثیر روانی رنگ‌ها بر مشتریان را بسنجد</li>
                                            <li>✅ هماهنگی رنگ‌ها با نوع محصولات را بررسی کند</li>
                                            <li>✅ پیشنهادات بهینه‌سازی رنگ‌بندی ارائه دهد</li>
                                            <li>✅ استانداردهای بصری retail را اعمال کند</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-circle" style="color: #FF5733;"></i>
                                        رنگ اصلی برند
                                    </label>
                                    {{ form.primary_brand_color }}
                                    <small class="form-text">رنگ غالب در طراحی (مثل #FF5733)</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-circle" style="color: #33A1FF;"></i>
                                        رنگ ثانویه برند
                                    </label>
                                    {{ form.secondary_brand_color }}
                                    <small class="form-text">رنگ مکمل (اختیاری)</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-circle" style="color: #FFD700;"></i>
                                        رنگ تاکیدی برند
                                    </label>
                                    {{ form.accent_brand_color }}
                                    <small class="form-text">رنگ تاکیدی (اختیاری)</small>
                                </div>
                            </div>
                        </div>

                        <!-- بخش 3: نورپردازی -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">نورپردازی</h3>
                                    <p class="section-subtitle">تحلیل نور و روشنایی برای بهینه‌سازی فضای فروش</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-sun"></i>
                                        نوع نورپردازی
                                    </label>
                        {{ form.lighting_type }}
                                    <small class="form-text">نوع منبع نور</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-adjust"></i>
                                        شدت نور
                                    </label>
                                    {{ form.lighting_intensity }}
                                    <small class="form-text">میزان روشنایی</small>
                                </div>
                    </div>
                </div>

                        <!-- بخش 4: ویترین فروشگاه - مهم‌ترین بخش -->
                        <div class="form-section window-display-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-store-alt"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">ویترین فروشگاه</h3>
                                    <p class="section-subtitle">مهم‌ترین بخش برای جذب مشتری - تحلیل پیشرفته</p>
                                </div>
                            </div>
                            
                            <div class="window-display-explanation">
                                <div class="explanation-card">
                                    <div class="explanation-icon">
                                        <i class="fas fa-magnet"></i>
                                    </div>
                                    <div class="explanation-content">
                                        <h4>چرا ویترین مهم‌ترین بخش است؟</h4>
                                        <p>هوش مصنوعی با تحلیل ویترین می‌تواند:</p>
                                        <ul>
                                            <li>✅ قدرت جذب مشتری را اندازه‌گیری کند</li>
                                            <li>✅ تأثیر بصری بر عابران را بسنجد</li>
                                            <li>✅ بهینه‌سازی چیدمان محصولات را پیشنهاد دهد</li>
                                            <li>✅ استانداردهای retail UX را اعمال کند</li>
                                            <li>✅ پیش‌بینی رفتار مشتریان را انجام دهد</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-window-maximize"></i>
                                        نوع ویترین
                                    </label>
                                    {{ form.window_display_type }}
                                    <small class="form-text">ساختار ویترین</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-ruler"></i>
                                        اندازه ویترین
                                    </label>
                                    {{ form.window_display_size }}
                                    <small class="form-text">ابعاد ویترین</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-theater-masks"></i>
                                        تم ویترین
                                    </label>
                                    {{ form.window_display_theme }}
                                    <small class="form-text">مفهوم و پیام ویترین</small>
                                </div>
                            </div>
                        </div>

                        <!-- بخش 5: عکس‌های طراحی -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">عکس‌های طراحی و دکوراسیون</h3>
                                    <p class="section-subtitle">تحلیل بصری با هوش مصنوعی</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس طراحی - نمای کلی
                                    </label>
                                    {{ form.design_photos_1 }}
                                    <small class="form-text">نمای کلی طراحی و دکوراسیون</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس طراحی - نورپردازی
                                    </label>
                                    {{ form.design_photos_2 }}
                                    <small class="form-text">نورپردازی و روشنایی</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس طراحی - ویترین
                                    </label>
                                    {{ form.design_photos_3 }}
                                    <small class="form-text">ویترین و نمایش محصولات</small>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-image"></i>
                                        عکس طراحی - جزئیات
                                    </label>
                                    {{ form.design_photos_4 }}
                                    <small class="form-text">جزئیات طراحی و تزئینات</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: رفتار مشتری - تحلیل پیشرفته بر اساس نوع فروشگاه -->
                <div class="wizard-step" data-step="4">
                    <div class="step-header">
                    <h2 class="step-title">رفتار مشتری</h2>
                        <p class="step-description">تحلیل پیشرفته الگوهای رفتاری و ترافیک مشتریان</p>
                    </div>
                    
                    <div class="form-container">
                        <!-- بخش 1: آمار کلی مشتریان -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">آمار کلی مشتریان</h3>
                                    <p class="section-subtitle">تحلیل ترافیک و الگوهای رفتاری</p>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-chart-line"></i>
                                        مشتریان روزانه
                                    </label>
                        {{ form.daily_customers }}
                                    <small class="form-text">میانگین تعداد مشتریان روزانه</small>
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-clock"></i>
                                        مدت زمان حضور مشتری
                                    </label>
                        {{ form.customer_time }}
                                    <small class="form-text">مدت زمان حضور مشتری در فروشگاه</small>
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-route"></i>
                                        الگوی حرکت مشتریان
                                    </label>
                                    {{ form.customer_flow }}
                                    <small class="form-text">الگوی حرکت مشتریان در فروشگاه</small>
                                </div>
                            </div>
                    </div>

                        <!-- بخش 2: نقاط توقف مشتریان -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">نقاط توقف مشتریان</h3>
                                    <p class="section-subtitle">تطبیق با نوع فروشگاه - کجاها بیشتر توقف می‌کنند؟</p>
                                </div>
                            </div>
                            
                            <div class="customer-behavior-explanation">
                                <div class="explanation-card">
                                    <div class="explanation-icon">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <div class="explanation-content">
                                        <h4>چرا تحلیل نقاط توقف مهم است؟</h4>
                                        <p>هوش مصنوعی با تحلیل نقاط توقف می‌تواند:</p>
                                        <ul>
                                            <li>✅ الگوهای رفتاری مشتریان را شناسایی کند</li>
                                            <li>✅ نقاط ضعف و قوت فروشگاه را پیدا کند</li>
                                            <li>✅ پیشنهادات بهینه‌سازی چیدمان ارائه دهد</li>
                                            <li>✅ استراتژی‌های بازاریابی هدفمند پیشنهاد دهد</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field full-width">
                                    <label class="form-label required-field">
                                        <i class="fas fa-stop-circle"></i>
                                        نقاط توقف مشتریان
                                    </label>
                                    <div class="form-input-wrapper">
                                        {{ form.stopping_points }}
                                    </div>
                                    <small class="form-text">نقاط توقف مشتریان - کجاها بیشتر توقف می‌کنند؟</small>
                                </div>
                            </div>
                        </div>

                        <!-- بخش 3: مناطق پرترافیک -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-traffic-light"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">مناطق پرترافیک</h3>
                                    <p class="section-subtitle">تطبیق با نوع فروشگاه - کجاها بیشتر شلوغ است؟</p>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-field full-width">
                                    <label class="form-label required-field">
                                        <i class="fas fa-fire"></i>
                                        مناطق پرترافیک
                                    </label>
                                    <div class="form-input-wrapper">
                                        {{ form.high_traffic_areas }}
                                    </div>
                                    <small class="form-text">مناطق پرترافیک - کجاها بیشتر شلوغ است؟</small>
                                </div>
                            </div>
                        </div>

                        <!-- بخش 4: فیلم‌های مسیر مشتریان -->
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="fas fa-video"></i>
                                </div>
                                <div class="section-info">
                                    <h3 class="section-title">فیلم‌های مسیر مشتریان</h3>
                                    <p class="section-subtitle">تحلیل بصری مسیر حرکت مشتریان</p>
                        </div>
                    </div>

                            <div class="video-analysis-explanation">
                                <div class="explanation-card">
                                    <div class="explanation-icon">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="explanation-content">
                                        <h4>چرا فیلم‌های مسیر مهم است؟</h4>
                                        <p>هوش مصنوعی با تحلیل فیلم‌ها می‌تواند:</p>
                                        <ul>
                                            <li>✅ الگوهای حرکت مشتریان را شناسایی کند</li>
                                            <li>✅ نقاط ترافیک و ازدحام را پیدا کند</li>
                                            <li>✅ بهینه‌سازی مسیرها را پیشنهاد دهد</li>
                                            <li>✅ پیش‌بینی رفتار مشتریان را انجام دهد</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label">
                            <i class="fas fa-video"></i>
                                        فیلم مسیر مشتریان - طبقه اول/ورودی اصلی
                                    </label>
                                    {{ form.customer_flow_video_1 }}
                                    <small class="form-text">فیلم مسیر حرکت مشتریان در طبقه اول یا ورودی اصلی</small>
                        </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-video"></i>
                                        فیلم مسیر مشتریان - طبقه دوم/ورودی فرعی
                                    </label>
                                    {{ form.customer_flow_video_2 }}
                                    <small class="form-text">فیلم مسیر حرکت مشتریان در طبقه دوم یا ورودی فرعی</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Step 5: فروش و محصولات -->
                <div class="wizard-step" data-step="5">
                    <div class="step-header">
                    <h2 class="step-title">فروش و محصولات</h2>
                        <p class="step-description">تحلیل فروش و دسته‌بندی محصولات برای بهینه‌سازی</p>
                    </div>
                    
                    <div class="form-container">
                        <!-- بخش 1: دسته‌بندی محصولات -->
                    <div class="form-section">
                        <h3 class="section-title">
                                <i class="fas fa-tags"></i>
                                دسته‌بندی محصولات
                        </h3>
                            <p class="section-description">نوع محصولات موجود در فروشگاه خود را انتخاب کنید</p>
                            
                            <div class="store-type-info" id="storeTypeInfo">
                                <div class="info-card">
                                    <i class="fas fa-info-circle"></i>
                                    <div class="info-content">
                                        <h4>دسته‌بندی‌های نمایش داده شده بر اساس نوع فروشگاه شما</h4>
                                        <p>فقط دسته‌بندی‌های مربوط به <span id="currentStoreType">نوع فروشگاه انتخابی</span> نمایش داده می‌شوند</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- فیلد Django برای دسته‌بندی محصولات -->
                    <div class="form-group">
                                <label class="form-label required-field">
                                    <i class="fas fa-tags"></i>
                                    دسته‌بندی محصولات *
                                </label>
                                
                                <!-- Smart Product Categories Selector -->
                                <div class="smart-category-selector">
                                    <div class="category-search-box">
                                        <input type="text" id="categorySearch" placeholder="جستجو در دسته‌بندی‌ها..." class="form-control">
                                        <i class="fas fa-search"></i>
                                    </div>
                                    
                                    <div class="category-grid-modern">
                                        <!-- Dynamic categories will be loaded here -->
                                        <div class="category-item" data-category="food">
                                            <div class="category-icon">
                                                <i class="fas fa-utensils"></i>
                                            </div>
                                            <div class="category-info">
                                                <h4>مواد غذایی</h4>
                                                <p>غذا، نوشیدنی، تنقلات</p>
                                            </div>
                                            <div class="category-checkbox">
                                                <input type="checkbox" name="product_categories" value="food" id="cat_food">
                                                <label for="cat_food">
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="category-item" data-category="clothing">
                                            <div class="category-icon">
                                                <i class="fas fa-tshirt"></i>
                                            </div>
                                            <div class="category-info">
                                                <h4>پوشاک</h4>
                                                <p>لباس، کفش، اکسسوری</p>
                                            </div>
                                            <div class="category-checkbox">
                                                <input type="checkbox" name="product_categories" value="clothing" id="cat_clothing">
                                                <label for="cat_clothing">
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="category-item" data-category="electronics">
                                            <div class="category-icon">
                                                <i class="fas fa-laptop"></i>
                                            </div>
                                            <div class="category-info">
                                                <h4>الکترونیک</h4>
                                                <p>موبایل، لپ‌تاپ، لوازم خانگی</p>
                                            </div>
                                            <div class="category-checkbox">
                                                <input type="checkbox" name="product_categories" value="electronics" id="cat_electronics">
                                                <label for="cat_electronics">
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="category-item" data-category="health">
                                            <div class="category-icon">
                                                <i class="fas fa-heartbeat"></i>
                                            </div>
                                            <div class="category-info">
                                                <h4>سلامت و دارو</h4>
                                                <p>دارو، مکمل، بهداشت</p>
                                            </div>
                                            <div class="category-checkbox">
                                                <input type="checkbox" name="product_categories" value="health" id="cat_health">
                                                <label for="cat_health">
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="category-item" data-category="home">
                                            <div class="category-icon">
                                                <i class="fas fa-home"></i>
                                            </div>
                                            <div class="category-info">
                                                <h4>لوازم خانگی</h4>
                                                <p>دکوراسیون، آشپزخانه</p>
                                            </div>
                                            <div class="category-checkbox">
                                                <input type="checkbox" name="product_categories" value="home" id="cat_home">
                                                <label for="cat_home">
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="category-item" data-category="sports">
                                            <div class="category-icon">
                                                <i class="fas fa-dumbbell"></i>
                                            </div>
                                            <div class="category-info">
                                                <h4>ورزشی</h4>
                                                <p>لوازم ورزش، کفش ورزشی</p>
                                            </div>
                                            <div class="category-checkbox">
                                                <input type="checkbox" name="product_categories" value="sports" id="cat_sports">
                                                <label for="cat_sports">
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="selected-categories-summary">
                                        <h4>دسته‌بندی‌های انتخاب شده:</h4>
                                        <div class="selected-tags" id="selectedCategories">
                                            <span class="no-selection">هیچ دسته‌ای انتخاب نشده</span>
                                        </div>
                                    </div>
                                </div>
                                
                                {% if form.product_categories.errors %}
                                    <div class="error-message">
                                        {{ form.product_categories.errors }}
                                    </div>
                                {% endif %}
                                <small class="form-text">حداقل یک دسته محصول را انتخاب کنید (اجباری)</small>
                            </div>
                            
                            <!-- فیلدهای دستی برای نمایش بهتر (اختیاری) -->
                            <div class="product-categories-container" style="display: none;">
                                <div class="category-grid">
                                    <!-- مواد غذایی و نوشیدنی -->
                                    <div class="category-group" data-category="food">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-utensils"></i>
                                            مواد غذایی و نوشیدنی
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="fresh_food" name="product_categories" value="fresh_food">
                                                <label for="fresh_food">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">مواد غذایی تازه</span>
                                                    <span class="label-desc">میوه، سبزی، گوشت</span>
                                    </label>
                                </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="dairy_products" name="product_categories" value="dairy_products">
                                                <label for="dairy_products">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">محصولات لبنی</span>
                                                    <span class="label-desc">شیر، پنیر، ماست</span>
                                                </label>
                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="bakery" name="product_categories" value="bakery">
                                                <label for="bakery">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">نان و شیرینی</span>
                                                    <span class="label-desc">نان تازه، کیک، بیسکویت</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="beverages" name="product_categories" value="beverages">
                                                <label for="beverages">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">نوشیدنی‌ها</span>
                                                    <span class="label-desc">آب، نوشابه، آبمیوه</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="snacks" name="product_categories" value="snacks">
                                                <label for="snacks">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">تنقلات</span>
                                                    <span class="label-desc">چیپس، آجیل، آبنبات</span>
                                                </label>
                                            </div>
                        </div>
                    </div>

                                    <!-- لوازم خانگی و بهداشتی -->
                                    <div class="category-group" data-category="household">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-home"></i>
                                            لوازم خانگی و بهداشتی
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="cleaning_supplies" name="product_categories" value="cleaning_supplies">
                                                <label for="cleaning_supplies">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">مواد شوینده</span>
                                                    <span class="label-desc">شامپو، صابون، پاک‌کننده</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="personal_care" name="product_categories" value="personal_care">
                                                <label for="personal_care">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">بهداشت شخصی</span>
                                                    <span class="label-desc">خمیردندان، شامپو، صابون</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="cosmetics" name="product_categories" value="cosmetics">
                                                <label for="cosmetics">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">آرایشی و زیبایی</span>
                                                    <span class="label-desc">لوازم آرایش، عطر</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="baby_care" name="product_categories" value="baby_care">
                                                <label for="baby_care">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">لوازم نوزاد</span>
                                                    <span class="label-desc">پوشک، شیر خشک، اسباب‌بازی</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- پوشاک و اکسسوری -->
                                    <div class="category-group" data-category="clothing">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-tshirt"></i>
                                            پوشاک و اکسسوری
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="womens_clothing" name="product_categories" value="womens_clothing">
                                                <label for="womens_clothing">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">پوشاک زنانه</span>
                                                    <span class="label-desc">لباس، کفش، کیف</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="mens_clothing" name="product_categories" value="mens_clothing">
                                                <label for="mens_clothing">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">پوشاک مردانه</span>
                                                    <span class="label-desc">لباس، کفش، اکسسوری</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="kids_clothing" name="product_categories" value="kids_clothing">
                                                <label for="kids_clothing">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">پوشاک کودک</span>
                                                    <span class="label-desc">لباس، کفش، اسباب‌بازی</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- الکترونیک و تکنولوژی -->
                                    <div class="category-group" data-category="electronics">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-mobile-alt"></i>
                                            الکترونیک و تکنولوژی
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="electronics" name="product_categories" value="electronics">
                                                <label for="electronics">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">لوازم الکترونیک</span>
                                                    <span class="label-desc">موبایل، تبلت، لپ‌تاپ</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="home_appliances" name="product_categories" value="home_appliances">
                                                <label for="home_appliances">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">لوازم خانگی برقی</span>
                                                    <span class="label-desc">یخچال، ماشین لباسشویی</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="mobile_accessories" name="product_categories" value="mobile_accessories">
                                                <label for="mobile_accessories">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">لوازم موبایل</span>
                                                    <span class="label-desc">کیف، شارژر، هندزفری</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- سلامت و دارو -->
                                    <div class="category-group" data-category="health">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-pills"></i>
                                            سلامت و دارو
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="pharmacy" name="product_categories" value="pharmacy">
                                                <label for="pharmacy">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">دارو و مکمل</span>
                                                    <span class="label-desc">داروهای تجویزی و بدون نسخه</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="health_products" name="product_categories" value="health_products">
                                                <label for="health_products">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">محصولات سلامت</span>
                                                    <span class="label-desc">ویتامین، مکمل، تجهیزات پزشکی</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- کتاب و لوازم التحریر -->
                                    <div class="category-group" data-category="books">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-book"></i>
                                            کتاب و لوازم التحریر
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="books" name="product_categories" value="books">
                                                <label for="books">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">کتاب و مجله</span>
                                                    <span class="label-desc">کتاب، مجله، لوازم التحریر</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ورزش و سرگرمی -->
                                    <div class="category-group" data-category="sports">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-dumbbell"></i>
                                            ورزش و سرگرمی
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="sports" name="product_categories" value="sports">
                                                <label for="sports">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">لوازم ورزشی</span>
                                                    <span class="label-desc">تجهیزات ورزشی، اسباب‌بازی</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- جواهرات و لوکس -->
                                    <div class="category-group" data-category="jewelry">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-gem"></i>
                                            جواهرات و لوکس
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="jewelry" name="product_categories" value="jewelry">
                                                <label for="jewelry">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">جواهرات</span>
                                                    <span class="label-desc">طلا، نقره، ساعت</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- خودرو و موتورسیکلت -->
                                    <div class="category-group" data-category="automotive">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-car"></i>
                                            خودرو و موتورسیکلت
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="automotive" name="product_categories" value="automotive">
                                                <label for="automotive">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">لوازم خودرو</span>
                                                    <span class="label-desc">قطعات، اکسسوری، ابزار</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- سایر -->
                                    <div class="category-group" data-category="other">
                                        <h4 class="category-group-title">
                                            <i class="fas fa-ellipsis-h"></i>
                                            سایر دسته‌ها
                                        </h4>
                                        <div class="category-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="other" name="product_categories" value="other">
                                                <label for="other">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">سایر محصولات</span>
                                                    <span class="label-desc">محصولات متفرقه و خاص</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- بخش 2: اطلاعات فروش -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-chart-line"></i>
                                اطلاعات فروش
                            </h3>
                            <p class="section-description">اطلاعات فروش روزانه و محصولات پرفروش</p>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-star"></i>
                                        محصولات پرفروش
                                    </label>
                                    <div class="textarea-container">
                        {{ form.top_products }}
                                        <div class="textarea-counter">
                                            <span class="char-count">0</span>/1000
                                        </div>
                                    </div>
                                    <small class="form-text">محصولاتی که بیشترین فروش را دارند (مثال: نان، شیر، نوشابه)</small>
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-money-bill-wave"></i>
                                        حجم فروش روزانه
                                    </label>
                                    <div class="input-group">
                        {{ form.daily_sales }}
                                        <div class="input-group-append">
                                            <span class="input-group-text">تومان</span>
                                        </div>
                                    </div>
                                    <small class="form-text">میانگین فروش روزانه فروشگاه</small>
                                </div>
                            </div>
                    </div>

                        <!-- بخش 3: فایل فروش -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-file-upload"></i>
                                فایل فروش (اختیاری)
                            </h3>
                            <p class="section-description">آپلود فایل فروش برای تحلیل دقیق‌تر</p>
                            
                            <div class="file-upload-container">
                                <div class="file-upload-area" id="salesFileUpload">
                                    <div class="file-upload-content">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <h4>فایل فروش را اینجا بکشید</h4>
                                        <p>یا کلیک کنید تا فایل انتخاب کنید</p>
                                        <div class="supported-formats">
                                            <span class="format-tag">Excel</span>
                                            <span class="format-tag">CSV</span>
                                            <span class="format-tag">PDF</span>
                                        </div>
                        </div>
                        {{ form.sales_file }}
                        </div>
                                <div class="file-info" id="salesFileInfo" style="display: none;">
                                    <div class="file-details">
                                        <i class="fas fa-file-excel"></i>
                                        <div class="file-meta">
                                            <span class="file-name"></span>
                                            <span class="file-size"></span>
                                        </div>
                                        <button type="button" class="remove-file" onclick="removeSalesFile()">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: امنیت و نظارت -->
                <div class="wizard-step" data-step="6">
                    <div class="step-header">
                    <h2 class="step-title">امنیت و نظارت</h2>
                        <p class="step-description">سیستم‌های نظارتی و امنیتی برای تحلیل رفتاری</p>
                    </div>
                    
                    <div class="form-container">
                        <!-- بخش 1: سیستم نظارتی -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-shield-alt"></i>
                            سیستم نظارتی
                        </h3>
                            <p class="section-description">اطلاعات سیستم نظارتی برای تحلیل رفتاری مشتریان</p>
                            
                            <div class="security-options-container">
                                <!-- دوربین نظارتی -->
                                <div class="security-option-card">
                                    <div class="security-option-header">
                                        <div class="security-icon">
                                            <i class="fas fa-video"></i>
                                        </div>
                                        <div class="security-info">
                                            <h4>دوربین نظارتی</h4>
                                            <p>آیا سیستم دوربین نظارتی دارید؟</p>
                                        </div>
                                        <div class="security-toggle">
                                            <div class="modern-toggle">
                                                <input type="checkbox" id="id_has_cameras" name="has_cameras">
                                                <label for="id_has_cameras">
                                                    <span class="toggle-slider"></span>
                            </label>
                                            </div>
                        </div>
                    </div>

                                    <div class="security-details" id="cameraDetails" style="display: none;">
                                        <div class="form-grid">
                                            <div class="form-field">
                                                <label class="form-label">
                                                    <i class="fas fa-camera"></i>
                                                    تعداد دوربین‌ها
                                                </label>
                                {{ form.camera_count }}
                                                <small class="form-text">تعداد کل دوربین‌های نصب شده</small>
                            </div>
                                            
                                            <div class="form-field">
                                                <label class="form-label">
                                                    <i class="fas fa-map-marker-alt"></i>
                                                    موقعیت دوربین‌ها
                                                </label>
                                                <div class="textarea-container">
                                {{ form.camera_locations }}
                                                    <div class="textarea-counter">
                                                        <span class="char-count">0</span>/500
                                                    </div>
                                                </div>
                                                <small class="form-text">موقعیت دقیق دوربین‌ها (مثال: ورودی، صندوق، راهروها)</small>
                                            </div>
                            </div>
                        </div>
                    </div>

                                <!-- فیلم نظارتی -->
                                <div class="security-option-card">
                                    <div class="security-option-header">
                                        <div class="security-icon">
                                            <i class="fas fa-film"></i>
                                        </div>
                                        <div class="security-info">
                                            <h4>فیلم نظارتی</h4>
                                            <p>آپلود فیلم برای تحلیل رفتاری (اختیاری)</p>
                                        </div>
                                    </div>
                                    
                                    <div class="file-upload-container">
                                        <div class="file-upload-area" id="surveillanceFileUpload">
                                            <div class="file-upload-content">
                            <i class="fas fa-video"></i>
                                                <h4>فیلم نظارتی را اینجا بکشید</h4>
                                                <p>یا کلیک کنید تا فایل انتخاب کنید</p>
                                                <div class="supported-formats">
                                                    <span class="format-tag">MP4</span>
                                                    <span class="format-tag">AVI</span>
                                                    <span class="format-tag">MOV</span>
                                                </div>
                        </div>
                        {{ form.surveillance_footage }}
                        </div>
                                        <div class="file-info" id="surveillanceFileInfo" style="display: none;">
                                            <div class="file-details">
                                                <i class="fas fa-video"></i>
                                                <div class="file-meta">
                                                    <span class="file-name"></span>
                                                    <span class="file-size"></span>
                                                </div>
                                                <button type="button" class="remove-file" onclick="removeSurveillanceFile()">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 7: اهداف و خروجی -->
                <div class="wizard-step" data-step="7">
                    <div class="step-header">
                    <h2 class="step-title">اهداف و خروجی</h2>
                        <p class="step-description">تعیین اهداف بهبود و نوع گزارش مورد انتظار</p>
                    </div>
                    
                    <div class="form-container">
                        <!-- بخش 1: اهداف بهینه‌سازی -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-target"></i>
                            اهداف بهینه‌سازی
                        </h3>
                            <p class="section-description">اهداف اصلی خود را برای بهبود فروشگاه انتخاب کنید</p>
                            
                            <div class="goals-container">
                                <div class="goals-grid">
                                    <!-- اهداف فروش و درآمد -->
                                    <div class="goal-category" data-category="sales">
                                        <h4 class="goal-category-title">
                                            <i class="fas fa-chart-line"></i>
                                            فروش و درآمد
                                        </h4>
                                        <div class="goal-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="increase_sales" name="optimization_goals" value="increase_sales">
                                                <label for="increase_sales">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">افزایش فروش و درآمد</span>
                                                    <span class="label-desc">بهبود عملکرد فروش و رشد درآمد</span>
                                    </label>
                                </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="increase_profit_margin" name="optimization_goals" value="increase_profit_margin">
                                                <label for="increase_profit_margin">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">افزایش حاشیه سود</span>
                                                    <span class="label-desc">بهبود سودآوری و کاهش هزینه‌ها</span>
                                                </label>
                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="boost_impulse_purchases" name="optimization_goals" value="boost_impulse_purchases">
                                                <label for="boost_impulse_purchases">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">افزایش خریدهای آنی</span>
                                                    <span class="label-desc">تحریک خریدهای غیرمنتظره مشتریان</span>
                                                </label>
                                            </div>
                        </div>
                    </div>

                                    <!-- اهداف تجربه مشتری -->
                                    <div class="goal-category" data-category="customer">
                                        <h4 class="goal-category-title">
                                            <i class="fas fa-users"></i>
                                            تجربه مشتری
                                        </h4>
                                        <div class="goal-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="improve_customer_experience" name="optimization_goals" value="improve_customer_experience">
                                                <label for="improve_customer_experience">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">بهبود تجربه مشتری</span>
                                                    <span class="label-desc">ارتقای کیفیت خدمات و رضایت مشتری</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="reduce_wait_time" name="optimization_goals" value="reduce_wait_time">
                                                <label for="reduce_wait_time">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">کاهش زمان انتظار</span>
                                                    <span class="label-desc">بهینه‌سازی صف‌ها و سرعت خدمات</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="increase_customer_satisfaction" name="optimization_goals" value="increase_customer_satisfaction">
                                                <label for="increase_customer_satisfaction">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">افزایش رضایت مشتری</span>
                                                    <span class="label-desc">ارتقای سطح رضایت و وفاداری مشتریان</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- اهداف عملیاتی -->
                                    <div class="goal-category" data-category="operational">
                                        <h4 class="goal-category-title">
                                            <i class="fas fa-cogs"></i>
                                            عملیات و کارایی
                                        </h4>
                                        <div class="goal-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="reduce_congestion" name="optimization_goals" value="reduce_congestion">
                                                <label for="reduce_congestion">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">کاهش ازدحام</span>
                                                    <span class="label-desc">بهینه‌سازی ترافیک و جریان مشتریان</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="optimize_space_utilization" name="optimization_goals" value="optimize_space_utilization">
                                                <label for="optimize_space_utilization">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">بهینه‌سازی فضا</span>
                                                    <span class="label-desc">استفاده بهتر از فضای فروشگاه</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="increase_operational_efficiency" name="optimization_goals" value="increase_operational_efficiency">
                                                <label for="increase_operational_efficiency">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">افزایش کارایی عملیاتی</span>
                                                    <span class="label-desc">بهبود فرآیندها و کاهش اتلاف</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- اهداف امنیت -->
                                    <div class="goal-category" data-category="security">
                                        <h4 class="goal-category-title">
                                            <i class="fas fa-shield-alt"></i>
                                            امنیت و نظارت
                                        </h4>
                                        <div class="goal-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="improve_security" name="optimization_goals" value="improve_security">
                                                <label for="improve_security">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">بهبود امنیت</span>
                                                    <span class="label-desc">تقویت سیستم‌های امنیتی و نظارتی</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="reduce_theft" name="optimization_goals" value="reduce_theft">
                                                <label for="reduce_theft">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">کاهش سرقت</span>
                                                    <span class="label-desc">پیشگیری از دزدی و کاهش ضرر</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-star"></i>
                                        مهم‌ترین هدف
                                    </label>
                        {{ form.priority_goal }}
                                    <small class="form-text">هدف اصلی که بیشترین اولویت را دارد</small>
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-clock"></i>
                                        بازه زمانی بهبود
                                    </label>
                        {{ form.improvement_timeline }}
                                    <small class="form-text">زمان مورد نظر برای دستیابی به اهداف</small>
                                </div>
                        </div>
                    </div>

                        <!-- بخش 2: نوع گزارش -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-file-alt"></i>
                            نوع گزارش
                        </h3>
                            <p class="section-description">نوع گزارش مورد انتظار و روش دریافت آن</p>
                            
                            <div class="report-options-container">
                                <div class="report-categories-grid">
                                    <!-- گزارش‌های تحلیلی -->
                                    <div class="report-category" data-category="analytical">
                                        <h4 class="report-category-title">
                                            <i class="fas fa-chart-bar"></i>
                                            گزارش‌های تحلیلی
                                        </h4>
                                        <div class="report-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="comprehensive_pdf" name="report_format" value="comprehensive_pdf">
                                                <label for="comprehensive_pdf">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">گزارش جامع PDF</span>
                                                    <span class="label-desc">تحلیل کامل با نمودارها و پیشنهادات</span>
                                    </label>
                                </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="executive_summary" name="report_format" value="executive_summary">
                                                <label for="executive_summary">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">خلاصه مدیریتی</span>
                                                    <span class="label-desc">خلاصه‌ای برای مدیران و تصمیم‌گیرندگان</span>
                                                </label>
                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="detailed_analysis" name="report_format" value="detailed_analysis">
                                                <label for="detailed_analysis">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">تحلیل تفصیلی</span>
                                                    <span class="label-desc">تحلیل عمیق برای کارشناسان</span>
                                                </label>
                                            </div>
                        </div>
                    </div>

                                    <!-- گزارش‌های عملیاتی -->
                                    <div class="report-category" data-category="operational">
                                        <h4 class="report-category-title">
                                            <i class="fas fa-tasks"></i>
                                            گزارش‌های عملیاتی
                                        </h4>
                                        <div class="report-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="action_plan" name="report_format" value="action_plan">
                                                <label for="action_plan">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">برنامه عملیاتی</span>
                                                    <span class="label-desc">مراحل اجرا و اقدامات مورد نیاز</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="implementation_guide" name="report_format" value="implementation_guide">
                                                <label for="implementation_guide">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">راهنمای پیاده‌سازی</span>
                                                    <span class="label-desc">دستورالعمل‌های گام به گام</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="checklist" name="report_format" value="checklist">
                                                <label for="checklist">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">چک‌لیست بهبود</span>
                                                    <span class="label-desc">فهرست اقدامات و پیشرفت</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- گزارش‌های بصری -->
                                    <div class="report-category" data-category="visual">
                                        <h4 class="report-category-title">
                                            <i class="fas fa-eye"></i>
                                            گزارش‌های بصری
                                        </h4>
                                        <div class="report-options">
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="visual_dashboard" name="report_format" value="visual_dashboard">
                                                <label for="visual_dashboard">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">داشبورد بصری</span>
                                                    <span class="label-desc">داشبورد آنلاین تعاملی</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="interactive_report" name="report_format" value="interactive_report">
                                                <label for="interactive_report">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">گزارش تعاملی</span>
                                                    <span class="label-desc">گزارش وب با قابلیت تعامل</span>
                                                </label>
                                            </div>
                                            <div class="modern-checkbox">
                                                <input type="checkbox" id="presentation_slides" name="report_format" value="presentation_slides">
                                                <label for="presentation_slides">
                                                    <span class="checkmark"></span>
                                                    <span class="label-text">اسلایدهای ارائه</span>
                                                    <span class="label-desc">پاورپوینت برای ارائه</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label required-field">
                                    <i class="fas fa-bell"></i>
                                    روش اطلاع‌رسانی
                                </label>
                        {{ form.notification_method }}
                                <small class="form-text">روش دریافت گزارش و اطلاع‌رسانی</small>
                        </div>
                    </div>

                        <!-- بخش 3: اطلاعات تماس -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user"></i>
                            اطلاعات تماس
                        </h3>
                            <p class="section-description">اطلاعات تماس برای ارسال گزارش و پیگیری</p>
                            
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-user-circle"></i>
                                        نام و نام خانوادگی
                                    </label>
                        {{ form.contact_name }}
                                    <small class="form-text">نام کامل برای ارتباط و ارسال گزارش</small>
                    </div>

                                <div class="form-field">
                                    <label class="form-label required-field">
                                        <i class="fas fa-envelope"></i>
                                        ایمیل
                                    </label>
                                {{ form.contact_email }}
                                    <small class="form-text">ایمیل برای دریافت گزارش‌ها</small>
                            </div>
                                
                                <div class="form-field">
                                    <label class="form-label">
                                        <i class="fas fa-phone"></i>
                                        شماره تماس
                                    </label>
                                {{ form.contact_phone }}
                                    <small class="form-text">شماره تماس برای پیگیری (اختیاری)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="wizard-navigation">
                <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                    <i class="fas fa-arrow-right"></i> مرحله قبل
                </button>
                
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-secondary" id="saveBtn">
                        <i class="fas fa-save"></i> ذخیره موقت
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn">
                        مرحله بعد <i class="fas fa-arrow-left"></i>
                    </button>
                    <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">
                        <i class="fas fa-paper-plane"></i> ارسال نهایی
                    </button>
                    <button type="button" class="btn btn-warning" id="emergencySubmitBtn" style="display: none;" onclick="window.cleanWizard.ensureCSRFToken(); document.getElementById('wizardForm').submit();">
                        <i class="fas fa-exclamation-triangle"></i> ارسال اضطراری
                    </button>
                    <button type="button" class="btn btn-secondary" id="clearStorageBtn" onclick="window.cleanWizard.clearLocalStorage(); location.reload();">
                        <i class="fas fa-trash"></i> شروع مجدد
                    </button>
                </div>
            </div>
        </form>

        <!-- Loading State -->
        <div class="wizard-loading" id="loadingState">
            <div class="spinner"></div>
            <p>در حال پردازش با هوش مصنوعی...</p>
        </div>

        <!-- Success State -->
        <div class="wizard-success" id="successState">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>فرم با موفقیت ارسال شد!</h3>
            <p>تحلیل هوش مصنوعی شما در حال پردازش است.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
class CleanWizard {
    constructor() {
        this.currentStep = 1;
        this.totalSteps = 7;
        this.form = document.getElementById('wizardForm');
        this.step6Initialized = false;
        this.step7Initialized = false;
        this.checkboxStylingApplied = false;
        
        if (!this.form) {
            console.error('❌ Form not found in constructor!');
        }
        
        this.init();
    }

    init() {
        this.bindEvents();
        this.updateNavigation();
        this.loadSavedData();
        this.setupFileUploads();
        
        // Initialize store type based categories
        this.updateCategoriesBasedOnStoreType();
        
        // Initialize color input enhancements
        this.initColorInputs();
        
        // Initialize smart category selector
        this.initSmartCategorySelector();
        
        // Form submission is handled in bindEvents
        
        this.debugWizard();
    }
    
    debugWizard() {
        console.log('🔧 Clean Wizard Initialized');
        console.log('📊 Total Steps:', this.totalSteps);
        console.log('📍 Current Step:', this.currentStep);
        
        // بررسی فیلدهای فرم
        const formFields = document.querySelectorAll('input, select, textarea');
        console.log('📝 Total form fields found:', formFields.length);
        
        // بررسی گام‌های موجود
        const steps = document.querySelectorAll('.wizard-step');
        console.log('📋 Wizard steps found:', steps.length);
        
        steps.forEach((step, index) => {
            const stepNumber = step.dataset.step;
            const isActive = step.classList.contains('active');
            const isVisible = step.style.display !== 'none';
            console.log(`Step ${stepNumber}: ${isActive ? 'ACTIVE' : 'INACTIVE'} | Display: ${step.style.display} | Visible: ${isVisible}`);
        });
        
        // Test step 2 and step 5 fields specifically
        setTimeout(() => {
            // Step 2 fields
            const step2Fields = document.querySelectorAll('[data-step="2"] input, [data-step="2"] select, [data-step="2"] textarea');
            const step2FileFields = document.querySelectorAll('[data-step="2"] input[type="file"]');
            const step2RequiredFields = document.querySelectorAll('[data-step="2"] input[required], [data-step="2"] select[required], [data-step="2"] textarea[required]');
            console.log('🧪 Step 2 fields test:', step2Fields.length);
            console.log('📁 Step 2 file fields test:', step2FileFields.length);
            console.log('⚠️ Step 2 required fields test:', step2RequiredFields.length);
            
            // Step 5 fields
            const step5Fields = document.querySelectorAll('[data-step="5"] input, [data-step="5"] select, [data-step="5"] textarea');
            const step5Checkboxes = document.querySelectorAll('[data-step="5"] input[type="checkbox"]');
            const step5RequiredFields = document.querySelectorAll('[data-step="5"] input[required], [data-step="5"] select[required], [data-step="5"] textarea[required]');
            console.log('🧪 Step 5 fields test:', step5Fields.length);
            console.log('☑️ Step 5 checkboxes test:', step5Checkboxes.length);
            console.log('⚠️ Step 5 required fields test:', step5RequiredFields.length);
            
            step2RequiredFields.forEach((field, index) => {
                console.log(`Step 2 Required Field ${index + 1}:`, field.name, field.type, field.value ? 'HAS VALUE' : 'EMPTY');
            });
            
            step5Checkboxes.forEach((field, index) => {
                console.log(`Step 5 Checkbox ${index + 1}:`, field.name, field.value, field.checked ? 'CHECKED' : 'UNCHECKED');
            });
        }, 1000);
    }

    bindEvents() {
        // Navigation buttons
        document.getElementById('prevBtn').addEventListener('click', () => this.prevStep());
        document.getElementById('nextBtn').addEventListener('click', () => this.nextStep());
        document.getElementById('saveBtn').addEventListener('click', () => this.saveData());
        // Submit button will submit form naturally (type="submit")
        // No additional event listener needed - let form submit naturally
        
        // Form submission
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        
        // Show loading state when form actually submits
        this.form.addEventListener('submit', (e) => {
            if (this.currentStep === this.totalSteps) {
                setTimeout(() => {
                    this.showLoadingState();
                }, 100);
            }
        });
        
        // Global error handler
        window.addEventListener('error', (e) => {
            console.error('🚨 Global error:', e.error);
            if (e.error && e.error.message && e.error.message.includes('file')) {
                alert('خطا در آپلود فایل: ' + e.error.message);
            }
        });
        
        // Debugger bypass - Ctrl+Enter to submit
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                console.log('🚀 Ctrl+Enter pressed - forcing form submission');
                const form = document.getElementById('wizardForm');
                if (form) {
                    // Ensure CSRF token is present
                    this.ensureCSRFToken();
                    form.submit();
                }
            }
        });
        
        // Fix HTML5 validation issues
        this.fixValidationIssues();
        
        // Auto-save on input change
        this.form.addEventListener('input', () => this.autoSave());
        
        // Store type change handler
        const storeTypeField = document.getElementById('id_store_type');
        if (storeTypeField) {
            storeTypeField.addEventListener('change', () => {
                console.log('🏪 Store type changed, updating options...');
                this.updateOptionsBasedOnStoreType();
                // Also update categories if we're on step 5
                if (this.currentStep === 5) {
                    this.updateCategoriesBasedOnStoreType();
                }
            });
        }
        
        // File upload handlers
        this.setupFileUploads();
        
        // Step click navigation
        document.querySelectorAll('.step-item').forEach((step, index) => {
            step.addEventListener('click', () => {
                const stepNumber = index + 1;
                if (stepNumber <= this.currentStep || this.isStepCompleted(stepNumber - 1)) {
                    this.goToStep(stepNumber);
                }
            });
        });
        
        // Debug buttons removed for production
    }

    setupFileUploads() {
        const fileInputs = ['store_photos_1', 'store_photos_2', 'store_photos_3', 'store_photos_4', 'store_photos_5', 'store_photos_6', 'store_photos_7', 'store_photos_8', 'warehouse_photos', 'structure_files', 'design_photos_1', 'design_photos_2', 'design_photos_3', 'design_photos_4', 'customer_flow_video_1', 'customer_flow_video_2', 'store_plan', 'surveillance_footage', 'sales_file'];
        
        fileInputs.forEach(fieldName => {
            const input = document.getElementById(`id_${fieldName}`);
            if (input) {
                input.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        // بررسی اندازه فایل
                        const maxSize = 10 * 1024 * 1024; // 10MB
                        if (file.size > maxSize) {
                            alert(`فایل ${file.name} خیلی بزرگ است. حداکثر اندازه مجاز: 10MB`);
                            e.target.value = ''; // پاک کردن فایل
                            return;
                        }
                        
                        // بررسی نوع فایل
                        const allowedTypes = {
                            'store_photos_1': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_2': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_3': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_4': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_5': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_6': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_7': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'store_photos_8': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'warehouse_photos': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'structure_files': ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'],
                            'design_photos_1': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'design_photos_2': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'design_photos_3': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'design_photos_4': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
                            'customer_flow_video_1': ['video/mp4', 'video/avi', 'video/mov', 'video/wmv'],
                            'customer_flow_video_2': ['video/mp4', 'video/avi', 'video/mov', 'video/wmv'],
                            'store_plan': ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'],
                            'surveillance_footage': ['video/mp4', 'video/avi', 'video/mov', 'video/wmv'],
                            'sales_file': ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'text/csv']
                        };
                        
                        if (allowedTypes[fieldName] && !allowedTypes[fieldName].includes(file.type)) {
                            alert(`نوع فایل ${file.name} مجاز نیست.`);
                            e.target.value = ''; // پاک کردن فایل
                            return;
                        }
                        
                        this.updateFileUploadUI(fieldName, file.name);
                    }
                });
            } else {
                console.warn(`⚠️ File input not found: id_${fieldName}`);
            }
        });
    }

    updateFileUploadUI(fieldName, fileName) {
        const uploadSection = document.querySelector(`[onclick*="${fieldName}"]`);
        if (uploadSection) {
            uploadSection.innerHTML = `
                <i class="fas fa-check-circle text-success"></i>
                <p class="text-success">فایل آپلود شد</p>
                <small>${fileName}</small>
            `;
            uploadSection.style.borderColor = '#28a745';
            uploadSection.style.background = '#d4edda';
        }
    }

    fixValidationIssues() {
        // Fix establishment_year field validation
        const establishmentYearField = document.getElementById('id_establishment_year');
        if (establishmentYearField) {
            // Remove HTML5 validation constraints for optional fields
            establishmentYearField.removeAttribute('min');
            establishmentYearField.removeAttribute('max');
            establishmentYearField.setAttribute('formnovalidate', 'true');
            
            // Add custom validation
            establishmentYearField.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                if (value && (value < 1900 || value > 2025)) {
                    e.target.setCustomValidity('سال باید بین 1900 تا 2025 باشد');
                } else {
                    e.target.setCustomValidity('');
                }
            });
        }
    }



    nextStep() {
        if (this.validateCurrentStep()) {
            if (this.currentStep < this.totalSteps) {
                const nextStepNumber = this.currentStep + 1;
                this.showStep(nextStepNumber);
                this.updateNavigation();
                this.updateProgress();
            } else {
                // If we're at the last step, show submit button
                this.updateNavigation();
            }
        }
    }
    

    prevStep() {
        if (this.currentStep > 1) {
            const prevStepNumber = this.currentStep - 1;
            this.showStep(prevStepNumber);
            this.updateNavigation();
            this.updateProgress();
        }
    }

    goToStep(step) {
        if (step >= 1 && step <= this.totalSteps) {
            this.showStep(step);
            this.updateNavigation();
            this.updateProgress();
        }
    }

    showStep(step) {
        console.log('👁️ Showing step:', step);
        
        // Update currentStep to match the step being shown
        this.currentStep = step;
        
        // Hide all steps
        document.querySelectorAll('.wizard-step').forEach(el => {
            el.classList.remove('active');
            el.style.display = 'none';
        });
        
        // Show current step
        const currentStepEl = document.querySelector(`.wizard-step[data-step="${step}"]`);
        if (currentStepEl) {
            currentStepEl.classList.add('active');
            currentStepEl.style.display = 'block';
            console.log('✅ Step', step, 'is now visible');
        } else {
            console.error('❌ Step element not found for step:', step);
        }
        
        // Update stepper
        this.updateStepper(step);
        
        // Apply checkbox styling for all steps that have checkboxes
        if ([4, 5, 7].includes(step)) {
            setTimeout(() => {
                this.applyCheckboxStyling();
            }, 100);
        }
        
        // Also apply styling immediately
        if ([4, 5, 7].includes(step)) {
            this.applyCheckboxStyling();
        }
        
        // Initialize Step 5 enhancements
        if (step === 5) {
            setTimeout(() => {
                this.initStep5Enhancements();
            }, 200);
        }
        
        // Initialize Step 6 enhancements (only once)
        if (step === 6 && !this.step6Initialized) {
            setTimeout(() => {
                this.initStep6Enhancements();
                this.step6Initialized = true;
            }, 200);
        }
        
        // Initialize Step 7 enhancements (only once)
        if (step === 7 && !this.step7Initialized) {
            setTimeout(() => {
                this.initStep7Enhancements();
                this.step7Initialized = true;
            }, 200);
        }
        
        // Scroll to top of form
        this.scrollToTop();
    }
    
    applyCheckboxStyling() {
        if (this.checkboxStylingApplied) {
            return; // Already applied, skip
        }
        
        // Apply checkbox styling for all steps
        const checkboxFields = [
            'id_stopping_points',
            'id_high_traffic_areas', 
            'id_product_categories',
            'id_optimization_goals',
            'id_report_format'
        ];
        
        checkboxFields.forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element) {
                this.styleCheckboxField(element, fieldId);
            }
        });
        
        // Apply dynamic options based on store type
        this.updateOptionsBasedOnStoreType();
        
        this.checkboxStylingApplied = true;
    }
    
    // Step 5 Modern Form Enhancements
    initStep5Enhancements() {
        // Initialize Step 5 modern enhancements
        
        // Update categories based on store type
        this.updateCategoriesBasedOnStoreType();
        
        // Character counter for textarea
        this.initTextareaCounter();
        
        // File upload enhancements
        this.initFileUploadEnhancements();
        
        // Category group interactions
        this.initCategoryGroupInteractions();
        
        // Auto-save for step 5
        this.initStep5AutoSave();
    }
    
    // Store type to categories mapping
    getStoreTypeCategories() {
        return {
            'supermarket': ['food'],
            'hypermarket': ['food', 'household', 'electronics'],
            'convenience': ['food', 'household'],
            'pharmacy': ['health', 'household'],
            'electronics': ['electronics'],
            'clothing': ['clothing'],
            'home_appliances': ['electronics'],
            'bookstore': ['books'],
            'cosmetics': ['household'],
            'sports': ['sports'],
            'jewelry': ['jewelry'],
            'furniture': ['other'],
            'automotive': ['automotive'],
            'pet_shop': ['other'],
            'garden_center': ['other'],
            'department': ['food', 'household', 'clothing', 'electronics', 'health'],
            'wholesale': ['food', 'household', 'electronics'],
            'other': ['food', 'household', 'clothing', 'electronics', 'health', 'other']
        };
    }
    
    updateCategoriesBasedOnStoreType() {
        const storeTypeSelect = document.getElementById('id_store_type');
        if (!storeTypeSelect) {
            console.warn('Store type select not found');
            return;
        }
        
        const selectedStoreType = storeTypeSelect.value;
        const categoryMapping = this.getStoreTypeCategories();
        const allowedCategories = categoryMapping[selectedStoreType] || categoryMapping['other'];
        
        console.log('🏪 Store type:', selectedStoreType);
        console.log('📦 Allowed categories:', allowedCategories);
        
        // Update store type info
        this.updateStoreTypeInfo(selectedStoreType);
        
        // Hide all category groups first
        const allCategoryGroups = document.querySelectorAll('.category-group');
        allCategoryGroups.forEach(group => {
            group.style.display = 'none';
        });
        
        // Show only relevant category groups with animation
        allowedCategories.forEach((category, index) => {
            const categoryGroup = document.querySelector(`[data-category="${category}"]`);
            if (categoryGroup) {
                categoryGroup.style.display = 'block';
                // Add staggered animation
                setTimeout(() => {
                    categoryGroup.style.opacity = '0';
                    categoryGroup.style.transform = 'translateY(20px)';
                    categoryGroup.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        categoryGroup.style.opacity = '1';
                        categoryGroup.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 100);
                console.log(`✅ Showing category group: ${category}`);
            } else {
                console.warn(`⚠️ Category group not found: ${category}`);
            }
        });
        
        // Update the grid layout if needed
        this.updateCategoryGridLayout(allowedCategories.length);
    }
    
    updateStoreTypeInfo(storeType) {
        const storeTypeNames = {
            'supermarket': 'سوپرمارکت',
            'hypermarket': 'هایپرمارکت',
            'convenience': 'فروشگاه راحتی',
            'pharmacy': 'داروخانه',
            'electronics': 'فروشگاه الکترونیک',
            'clothing': 'فروشگاه پوشاک',
            'home_appliances': 'فروشگاه لوازم خانگی',
            'bookstore': 'کتابفروشی',
            'cosmetics': 'فروشگاه لوازم آرایشی',
            'sports': 'فروشگاه ورزشی',
            'jewelry': 'فروشگاه جواهرات',
            'furniture': 'فروشگاه مبلمان',
            'automotive': 'فروشگاه لوازم خودرو',
            'pet_shop': 'فروشگاه حیوانات خانگی',
            'garden_center': 'فروشگاه گل و گیاه',
            'department': 'فروشگاه چندمنظوره',
            'wholesale': 'فروشگاه عمده‌فروشی',
            'other': 'سایر'
        };
        
        const currentStoreTypeSpan = document.getElementById('currentStoreType');
        if (currentStoreTypeSpan) {
            currentStoreTypeSpan.textContent = storeTypeNames[storeType] || 'نوع فروشگاه انتخابی';
        }
    }
    
    updateCategoryGridLayout(categoryCount) {
        const categoryGrid = document.querySelector('.category-grid');
        if (!categoryGrid) return;
        
        // Adjust grid columns based on number of visible categories
        if (categoryCount <= 2) {
            categoryGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(500px, 1fr))';
        } else if (categoryCount <= 4) {
            categoryGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(400px, 1fr))';
        } else {
            categoryGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(350px, 1fr))';
        }
    }
    
    initTextareaCounter() {
        const textarea = document.querySelector('#id_top_products');
        if (textarea) {
            const counter = document.querySelector('.char-count');
            if (counter) {
                textarea.addEventListener('input', () => {
                    const count = textarea.value.length;
                    counter.textContent = count;
                    
                    // Change color based on character count
                    if (count > 800) {
                        counter.style.color = '#e53e3e';
                    } else if (count > 600) {
                        counter.style.color = '#dd6b20';
                    } else {
                        counter.style.color = '#667eea';
                    }
                });
            }
        }
    }
    
    initFileUploadEnhancements() {
        const fileUploadArea = document.getElementById('salesFileUpload');
        const fileInput = document.getElementById('id_sales_file');
        const fileInfo = document.getElementById('salesFileInfo');
        
        if (fileUploadArea && fileInput) {
            // Click to upload
            fileUploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Drag and drop
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    this.handleFileUpload(files[0]);
                }
            });
            
            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    this.handleFileUpload(e.target.files[0]);
                }
            });
        }
    }
    
    handleFileUpload(file) {
        const fileInfo = document.getElementById('salesFileInfo');
        const fileUploadArea = document.getElementById('salesFileUpload');
        
        if (fileInfo && fileUploadArea) {
            // Show file info
            fileInfo.style.display = 'block';
            fileUploadArea.style.display = 'none';
            
            // Update file details
            const fileName = fileInfo.querySelector('.file-name');
            const fileSize = fileInfo.querySelector('.file-size');
            
            if (fileName) fileName.textContent = file.name;
            if (fileSize) fileSize.textContent = this.formatFileSize(file.size);
        }
    }
    
    formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    initCategoryGroupInteractions() {
        // Add click handlers for category groups
        const categoryGroups = document.querySelectorAll('.category-group');
        categoryGroups.forEach(group => {
            group.addEventListener('click', (e) => {
                // Don't trigger if clicking on checkbox or label
                if (e.target.type === 'checkbox' || e.target.tagName === 'LABEL') {
                    return;
                }
                
                // Find the first unchecked checkbox in this group
                const firstCheckbox = group.querySelector('input[type="checkbox"]:not(:checked)');
                if (firstCheckbox) {
                    firstCheckbox.checked = true;
                    firstCheckbox.dispatchEvent(new Event('change'));
                }
            });
        });
        
        // Add visual feedback for checkbox interactions
        const checkboxes = document.querySelectorAll('.modern-checkbox input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const label = checkbox.nextElementSibling;
                if (checkbox.checked) {
                    label.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        label.style.transform = 'scale(1)';
                    }, 200);
                }
            });
        });
    }
    
    initStep5AutoSave() {
        const step5Fields = document.querySelectorAll('[data-step="5"] input, [data-step="5"] textarea, [data-step="5"] select');
        step5Fields.forEach(field => {
            field.addEventListener('change', () => {
                this.saveData();
                this.showSaveMessage('اطلاعات گام ۵ ذخیره شد');
            });
        });
    }
    
    // Step 6 Modern Form Enhancements
    initStep6Enhancements() {
        // Initialize Step 6 modern enhancements
        
        // Toggle switch functionality
        this.initToggleSwitch();
        
        // File upload enhancements
        this.initSurveillanceFileUpload();
        
        // Character counter for textarea
        this.initCameraLocationsCounter();
        
        // Auto-save for step 6
        this.initStep6AutoSave();
    }
    
    initToggleSwitch() {
        const toggleSwitch = document.getElementById('id_has_cameras');
        const cameraDetails = document.getElementById('cameraDetails');
        
        if (toggleSwitch && cameraDetails) {
            toggleSwitch.addEventListener('change', () => {
                if (toggleSwitch.checked) {
                    cameraDetails.style.display = 'block';
                    // Add animation
                    setTimeout(() => {
                        cameraDetails.style.opacity = '0';
                        cameraDetails.style.transform = 'translateY(-10px)';
                        cameraDetails.style.transition = 'all 0.3s ease';
                        
                        setTimeout(() => {
                            cameraDetails.style.opacity = '1';
                            cameraDetails.style.transform = 'translateY(0)';
                        }, 100);
                    }, 50);
                } else {
                    cameraDetails.style.display = 'none';
                }
            });
        }
    }
    
    initSurveillanceFileUpload() {
        const fileUploadArea = document.getElementById('surveillanceFileUpload');
        const fileInput = document.getElementById('id_surveillance_footage');
        const fileInfo = document.getElementById('surveillanceFileInfo');
        
        if (fileUploadArea && fileInput) {
            // Click to upload
            fileUploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Drag and drop
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    this.handleSurveillanceFileUpload(files[0]);
                }
            });
            
            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    this.handleSurveillanceFileUpload(e.target.files[0]);
                }
            });
        }
    }
    
    handleSurveillanceFileUpload(file) {
        const fileInfo = document.getElementById('surveillanceFileInfo');
        const fileUploadArea = document.getElementById('surveillanceFileUpload');
        
        if (fileInfo && fileUploadArea) {
            // Show file info
            fileInfo.style.display = 'block';
            fileUploadArea.style.display = 'none';
            
            // Update file details
            const fileName = fileInfo.querySelector('.file-name');
            const fileSize = fileInfo.querySelector('.file-size');
            
            if (fileName) fileName.textContent = file.name;
            if (fileSize) fileSize.textContent = this.formatFileSize(file.size);
        }
    }
    
    initCameraLocationsCounter() {
        const textarea = document.querySelector('#id_camera_locations');
        if (textarea) {
            const counter = textarea.parentElement.querySelector('.char-count');
            if (counter) {
                textarea.addEventListener('input', () => {
                    const count = textarea.value.length;
                    counter.textContent = count;
                    
                    // Change color based on character count
                    if (count > 400) {
                        counter.style.color = '#e53e3e';
                    } else if (count > 300) {
                        counter.style.color = '#dd6b20';
                    } else {
                        counter.style.color = '#667eea';
                    }
                });
            }
        }
    }
    
    initStep6AutoSave() {
        const step6Fields = document.querySelectorAll('[data-step="6"] input, [data-step="6"] textarea, [data-step="6"] select');
        step6Fields.forEach(field => {
            field.addEventListener('change', () => {
                this.saveData();
                this.showSaveMessage('اطلاعات گام ۶ ذخیره شد');
            });
        });
    }
    
    // Step 7 Modern Form Enhancements
    initStep7Enhancements() {
        // Initialize Step 7 modern enhancements
        
        // Goals selection enhancements
        this.initGoalsSelection();
        
        // Report format selection enhancements
        this.initReportFormatSelection();
        
        // Auto-save for step 7
        this.initStep7AutoSave();
    }
    
    initGoalsSelection() {
        const goalCheckboxes = document.querySelectorAll('[name="optimization_goals"]');
        goalCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const label = checkbox.nextElementSibling;
                if (checkbox.checked) {
                    label.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        label.style.transform = 'scale(1)';
                    }, 200);
                }
            });
        });
    }
    
    initReportFormatSelection() {
        const reportCheckboxes = document.querySelectorAll('[name="report_format"]');
        reportCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const label = checkbox.nextElementSibling;
                if (checkbox.checked) {
                    label.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        label.style.transform = 'scale(1)';
                    }, 200);
                }
            });
        });
    }
    
    initStep7AutoSave() {
        const step7Fields = document.querySelectorAll('[data-step="7"] input, [data-step="7"] textarea, [data-step="7"] select');
        step7Fields.forEach(field => {
            field.addEventListener('change', () => {
                this.saveData();
                this.showSaveMessage('اطلاعات گام ۷ ذخیره شد');
            });
        });
    }
    
    // Form Submission Management
    initFormSubmission() {
        const form = document.getElementById('wizardForm');
        const submitBtn = document.getElementById('submitBtn');
        
        if (form && submitBtn) {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                this.handleFormSubmission();
            });
        }
    }
    
    handleFormSubmission() {
        // Validate all steps
        if (!this.validateAllSteps()) {
            this.showErrorMessage('لطفاً تمام فیلدهای اجباری را تکمیل کنید');
            return;
        }
        
        // Show loading state
        this.showLoadingState();
        
        // Prepare form data
        const formData = new FormData(document.getElementById('wizardForm'));
        
        // Submit form
        fetch('{% url "store_analysis:submit_analysis_request" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': this.getCSRFToken()
            }
        })
        .then(response => {
            if (response.ok) {
                return response;
            }
            throw new Error('خطا در ارسال درخواست');
        })
        .then(response => {
            // Redirect to payment page
            window.location.href = response.url;
        })
        .catch(error => {
            this.hideLoadingState();
            this.showErrorMessage('خطا در ارسال درخواست: ' + error.message);
        });
    }
    
    showErrorMessage(message) {
        alert(message);
    }
    
    validateAllSteps() {
        let isValid = true;
        console.log('🔍 Validating all steps...');
        
        // Validate each step
        for (let step = 1; step <= 7; step++) {
            const stepElement = document.querySelector(`[data-step="${step}"]`);
            if (stepElement) {
                const requiredFields = stepElement.querySelectorAll('input[required], textarea[required], select[required]');
                console.log(`📋 Step ${step}: Found ${requiredFields.length} required fields`);
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        console.log(`❌ Step ${step}: Empty field:`, field.name || field.id);
                        isValid = false;
                        field.classList.add('is-invalid');
                    } else {
                        // Check pattern validation for color fields
                        if (field.type === 'text' && field.pattern) {
                            const regex = new RegExp(field.pattern);
                            if (!regex.test(field.value)) {
                                console.log(`❌ Step ${step}: Pattern validation failed:`, field.name || field.id);
                                isValid = false;
                                field.classList.add('is-invalid');
                            } else {
                                field.classList.remove('is-invalid');
                            }
                        } else {
                            field.classList.remove('is-invalid');
                        }
                    }
                });
            } else {
                console.log(`❌ Step ${step}: Element not found`);
            }
        }
        
        console.log('✅ All steps validation result:', isValid);
        return isValid;
    }
    
    getCSRFToken() {
        const token = document.querySelector('[name=csrfmiddlewaretoken]');
        if (token) {
            return token.value;
        }
        // Fallback: get from meta tag
        const metaToken = document.querySelector('meta[name=csrf-token]');
        if (metaToken) {
            return metaToken.getAttribute('content');
        }
        // Fallback: get from Django's csrf_token
        const djangoToken = document.querySelector('[name=csrfmiddlewaretoken]');
        return djangoToken ? djangoToken.value : '';
    }
    
    ensureCSRFToken() {
        const form = document.getElementById('wizardForm');
        if (!form) return;
        
        // Check if CSRF token exists
        let csrfInput = form.querySelector('[name=csrfmiddlewaretoken]');
        if (!csrfInput) {
            // Create CSRF token input
            csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = this.getCSRFToken();
            form.appendChild(csrfInput);
            console.log('🔐 CSRF token added to form');
        } else {
            // Update existing token
            csrfInput.value = this.getCSRFToken();
            console.log('🔐 CSRF token updated in form');
        }
    }
    
    showLoadingState() {
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال ارسال...';
        }
        
        // Show loading message
        const loadingMessage = document.createElement('div');
        loadingMessage.id = 'loadingMessage';
        loadingMessage.innerHTML = `
            <div style="text-align: center; padding: 2rem; background: rgba(255,255,255,0.9); border-radius: 10px; margin: 1rem 0;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <p class="mt-3">در حال پردازش با هوش مصنوعی...</p>
            </div>
        `;
        
        // Insert loading message after the form
        const form = document.getElementById('wizardForm');
        if (form && form.parentNode) {
            form.parentNode.insertBefore(loadingMessage, form.nextSibling);
        }
    }
    
    hideLoadingState() {
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ارسال نهایی';
        }
        
        // Remove loading message
        const loadingMessage = document.getElementById('loadingMessage');
        if (loadingMessage) {
            loadingMessage.remove();
        }
    }
    
    styleCheckboxField(element, fieldId) {
        // Style checkbox field with modern design
        
        // Premium container styling
        element.style.display = 'grid';
        element.style.gridTemplateColumns = 'repeat(auto-fit, minmax(320px, 1fr))';
        element.style.gap = '2rem';
        element.style.width = '100%';
        element.style.margin = '0';
        element.style.padding = '2.5rem';
        element.style.background = 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)';
        element.style.border = '2px solid transparent';
        element.style.borderRadius = '20px';
        element.style.minHeight = '500px';
        element.style.position = 'relative';
        element.style.overflow = 'hidden';
        element.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.1)';
        element.style.backdropFilter = 'blur(10px)';
        element.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        
        // Style each div container (Django wraps each checkbox in a div)
        Array.from(element.children).forEach((child, index) => {
            child.style.display = 'flex';
            child.style.alignItems = 'center';
            child.style.margin = '0';
            child.style.padding = '1.5rem';
            child.style.background = 'linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)';
            child.style.border = '2px solid transparent';
            child.style.borderRadius = '16px';
            child.style.minHeight = '80px';
            child.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.1)';
            child.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
            child.style.cursor = 'pointer';
            child.style.position = 'relative';
            child.style.overflow = 'hidden';
            child.style.width = '100%';
            child.style.boxSizing = 'border-box';
            child.style.backdropFilter = 'blur(8px)';
            
            // Add premium hover effect
            child.addEventListener('mouseenter', function() {
                this.style.borderColor = 'rgba(102, 126, 234, 0.3)';
                this.style.boxShadow = '0 10px 25px -5px rgba(102, 126, 234, 0.2), 0 0 0 1px rgba(102, 126, 234, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.2)';
                this.style.transform = 'translateY(-4px) scale(1.02)';
            });
            
            child.addEventListener('mouseleave', function() {
                this.style.borderColor = 'transparent';
                this.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.1)';
                this.style.transform = 'translateY(0) scale(1)';
            });
            
            // Style inputs and labels inside
            const inputs = child.querySelectorAll('input');
            const labels = child.querySelectorAll('label');
            
            inputs.forEach(input => {
                input.style.width = '24px';
                input.style.height = '24px';
                input.style.margin = '0 16px 0 0';
                input.style.accentColor = '#667eea';
                input.style.cursor = 'pointer';
                input.style.flexShrink = '0';
                input.style.borderRadius = '6px';
                input.style.border = '2px solid #e2e8f0';
                input.style.background = '#ffffff';
                input.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                input.style.position = 'relative';
                input.style.zIndex = '2';
                input.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
            });
            
            labels.forEach(label => {
                label.style.display = 'flex';
                label.style.alignItems = 'center';
                label.style.fontSize = '15px';
                label.style.fontWeight = '600';
                label.style.color = '#1e293b';
                label.style.cursor = 'pointer';
                label.style.width = '100%';
                label.style.minHeight = '50px';
                label.style.lineHeight = '1.5';
                label.style.position = 'relative';
                label.style.zIndex = '1';
                label.style.letterSpacing = '0.025em';
                label.style.transition = 'all 0.3s ease';
            });
        });
    }
    
    initColorInputs() {
        // Initialize color input fields with suggestions
        const colorFields = ['primary_brand_color', 'secondary_brand_color', 'accent_brand_color'];
        
        colorFields.forEach(fieldName => {
            const field = document.getElementById(`id_${fieldName}`);
            if (field) {
                // Add color suggestions
                this.addColorSuggestions(field);
                
                // Add real-time color preview
                field.addEventListener('input', () => {
                    this.updateColorPreview(field);
                });
            }
        });
    }
    
    addColorSuggestions(field) {
        // Add datalist for color suggestions
        const datalist = document.createElement('datalist');
        datalist.id = `${field.id}_suggestions`;
        
        const colorSuggestions = [
            'قرمز', 'آبی', 'سبز', 'زرد', 'سفید', 'مشکی', 'خاکستری',
            'نارنجی', 'بنفش', 'صورتی', 'قهوه‌ای', 'طلایی', 'نقره‌ای',
            'قرمز روشن', 'آبی روشن', 'سبز روشن', 'زرد روشن',
            'قرمز تیره', 'آبی تیره', 'سبز تیره', 'خاکستری تیره',
            'آبی آسمانی', 'سبز دریایی', 'قرمز شرابی', 'آبی دریایی',
            'سبز زیتونی', 'قرمز گیلاسی', 'آبی کبالت', 'سبز نعنایی',
            'زرد لیمویی', 'نارنجی هویجی', 'بنفش ارغوانی', 'صورتی گلابی',
            'طلایی کهربایی', 'نقره‌ای پلاتینی'
        ];
        
        colorSuggestions.forEach(color => {
            const option = document.createElement('option');
            option.value = color;
            datalist.appendChild(option);
        });
        
        field.setAttribute('list', datalist.id);
        field.parentNode.appendChild(datalist);
    }
    
    updateColorPreview(field) {
        // Create or update color preview
        let preview = document.getElementById(`${field.id}_preview`);
        if (!preview) {
            preview = document.createElement('div');
            preview.id = `${field.id}_preview`;
            preview.style.cssText = `
                width: 30px;
                height: 30px;
                border: 2px solid #ddd;
                border-radius: 5px;
                display: inline-block;
                margin-right: 10px;
                vertical-align: middle;
            `;
            field.parentNode.insertBefore(preview, field);
        }
        
        // Update preview color
        const colorValue = this.getColorHex(field.value);
        if (colorValue && colorValue.startsWith('#')) {
            preview.style.backgroundColor = colorValue;
            preview.style.borderColor = colorValue;
        } else {
            preview.style.backgroundColor = '#f0f0f0';
            preview.style.borderColor = '#ddd';
        }
    }
    
    getColorHex(colorInput) {
        // Simple color name to HEX mapping
        const colorMap = {
            'قرمز': '#FF0000', 'آبی': '#0000FF', 'سبز': '#00FF00',
            'زرد': '#FFFF00', 'سفید': '#FFFFFF', 'مشکی': '#000000',
            'خاکستری': '#808080', 'نارنجی': '#FFA500', 'بنفش': '#800080',
            'صورتی': '#FFC0CB', 'قهوه‌ای': '#A52A2A', 'طلایی': '#FFD700',
            'نقره‌ای': '#C0C0C0', 'قرمز روشن': '#FF6B6B', 'آبی روشن': '#87CEEB',
            'سبز روشن': '#90EE90', 'زرد روشن': '#FFFFE0', 'صورتی روشن': '#FFB6C1',
            'نارنجی روشن': '#FFB366', 'قرمز تیره': '#8B0000', 'آبی تیره': '#00008B',
            'سبز تیره': '#006400', 'خاکستری تیره': '#696969', 'قهوه‌ای تیره': '#654321',
            'آبی آسمانی': '#87CEEB', 'سبز دریایی': '#2E8B57', 'قرمز شرابی': '#722F37',
            'آبی دریایی': '#4682B4', 'سبز زیتونی': '#808000', 'قرمز گیلاسی': '#DE3163',
            'آبی کبالت': '#0047AB', 'سبز نعنایی': '#98FB98', 'زرد لیمویی': '#FFFACD',
            'نارنجی هویجی': '#FF8C00', 'بنفش ارغوانی': '#8A2BE2', 'صورتی گلابی': '#FF69B4',
            'طلایی کهربایی': '#FFBF00', 'نقره‌ای پلاتینی': '#E5E4E2'
        };
        
        if (!colorInput) return null;
        
        const color = colorInput.trim().toLowerCase();
        
        // If it's already a HEX code, return it
        if (color.startsWith('#') && color.length === 7) {
            return color.toUpperCase();
        }
        
        // Return mapped color or original input
        return colorMap[color] || colorInput;
    }

    // ===== WORLD-CLASS SMART CATEGORY SELECTOR =====
    initSmartCategorySelector() {
        console.log('🎯 Initializing Smart Category Selector...');
        
        const categoryItems = document.querySelectorAll('.category-item');
        const searchInput = document.getElementById('categorySearch');
        const selectedTagsContainer = document.getElementById('selectedCategories');
        
        if (!categoryItems.length || !searchInput || !selectedTagsContainer) {
            console.log('⚠️ Smart Category Selector elements not found');
            return;
        }
        
        // Category data mapping
        const categoryData = {
            'food': { name: 'مواد غذایی', icon: 'fas fa-utensils', description: 'غذا، نوشیدنی، تنقلات' },
            'clothing': { name: 'پوشاک', icon: 'fas fa-tshirt', description: 'لباس، کفش، اکسسوری' },
            'electronics': { name: 'الکترونیک', icon: 'fas fa-laptop', description: 'موبایل، لپ‌تاپ، لوازم خانگی' },
            'health': { name: 'سلامت و دارو', icon: 'fas fa-heartbeat', description: 'دارو، مکمل، بهداشت' },
            'home': { name: 'لوازم خانگی', icon: 'fas fa-home', description: 'دکوراسیون، آشپزخانه' },
            'sports': { name: 'ورزشی', icon: 'fas fa-dumbbell', description: 'لوازم ورزش، کفش ورزشی' }
        };
        
        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            categoryItems.forEach(item => {
                const category = item.dataset.category;
                const categoryInfo = categoryData[category];
                if (categoryInfo) {
                    const matches = categoryInfo.name.toLowerCase().includes(searchTerm) ||
                                  categoryInfo.description.toLowerCase().includes(searchTerm);
                    item.style.display = matches ? 'flex' : 'none';
                }
            });
        });
        
        // Category selection
        categoryItems.forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            const category = item.dataset.category;
            
            // Click on item to toggle checkbox
            item.addEventListener('click', (e) => {
                if (e.target.type !== 'checkbox' && e.target.tagName !== 'LABEL') {
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
            
            // Checkbox change handler
            checkbox.addEventListener('change', (e) => {
                if (e.target.checked) {
                    item.classList.add('selected');
                    this.showCategorySelectedAnimation(item);
                } else {
                    item.classList.remove('selected');
                }
                this.updateSelectedCategories();
            });
        });
        
        // Initialize selected categories display
        this.updateSelectedCategories();
        
        console.log('✅ Smart Category Selector initialized successfully');
    }
    
    showCategorySelectedAnimation(item) {
        // Create ripple effect
        const ripple = document.createElement('div');
        ripple.style.cssText = `
            position: absolute;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
            width: 100px;
            height: 100px;
            left: 50%;
            top: 50%;
            margin-left: -50px;
            margin-top: -50px;
        `;
        
        item.style.position = 'relative';
        item.appendChild(ripple);
        
        setTimeout(() => {
            ripple.remove();
        }, 600);
    }
    
    updateSelectedCategories() {
        const selectedTagsContainer = document.getElementById('selectedCategories');
        const checkboxes = document.querySelectorAll('.category-item input[type="checkbox"]:checked');
        
        if (!selectedTagsContainer) return;
        
        // Clear existing tags
        selectedTagsContainer.innerHTML = '';
        
        if (checkboxes.length === 0) {
            selectedTagsContainer.innerHTML = '<span class="no-selection">هیچ دسته‌ای انتخاب نشده</span>';
            return;
        }
        
        // Category data mapping
        const categoryData = {
            'food': 'مواد غذایی',
            'clothing': 'پوشاک',
            'electronics': 'الکترونیک',
            'health': 'سلامت و دارو',
            'home': 'لوازم خانگی',
            'sports': 'ورزشی'
        };
        
        checkboxes.forEach(checkbox => {
            const category = checkbox.value;
            const categoryName = categoryData[category] || category;
            
            const tag = document.createElement('div');
            tag.className = 'category-tag';
            tag.innerHTML = `
                ${categoryName}
                <span class="remove-tag" data-category="${category}">×</span>
            `;
            
            // Remove tag functionality
            const removeBtn = tag.querySelector('.remove-tag');
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                checkbox.checked = false;
                checkbox.dispatchEvent(new Event('change'));
            });
            
            selectedTagsContainer.appendChild(tag);
        });
    }
    
    updateOptionsBasedOnStoreType() {
        const storeTypeField = document.getElementById('id_store_type');
        if (!storeTypeField) return;
        
        const storeType = storeTypeField.value;
        
        // Define comprehensive store type specific options
        const storeTypeOptions = {
            'accessories': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'jewelry_display', 'watch_display', 'bag_display', 'mirror_area',
                    'accessories_counter', 'gift_wrapping', 'security_check'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'jewelry_section', 'watch_section',
                    'bag_section', 'accessories_display', 'promotions', 'new_arrivals',
                    'sale_rack', 'gift_section'
                ],
                product_categories: [
                    'jewelry', 'watches', 'bags', 'belts', 'scarves', 'sunglasses',
                    'hair_accessories', 'phone_accessories', 'keychains', 'gift_items'
                ]
            },
            'clothing': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'fitting_room', 'mirror_area', 'size_chart', 'restroom',
                    'styling_consultation', 'alteration_service', 'gift_wrapping'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'men_section', 'women_section',
                    'kids_section', 'sale_rack', 'fitting_room_area', 'new_arrivals',
                    'trending_items', 'seasonal_display'
                ],
                product_categories: [
                    'mens_clothing', 'womens_clothing', 'kids_clothing', 'shoes',
                    'accessories', 'formal_wear', 'casual_wear', 'sportswear',
                    'underwear', 'seasonal_items'
                ]
            },
            'electronics': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'demo_area', 'technical_support', 'warranty_desk', 'restroom',
                    'repair_service', 'installation_help', 'product_consultation'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'mobile_section', 'laptop_section',
                    'audio_section', 'gaming_section', 'demo_area', 'smart_home',
                    'accessories_wall', 'clearance_section'
                ],
                product_categories: [
                    'smartphones', 'laptops', 'tablets', 'audio_devices', 'gaming_consoles',
                    'smart_home', 'camera_equipment', 'computer_accessories', 'mobile_accessories',
                    'home_appliances', 'office_equipment'
                ]
            },
            'supermarket': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'restroom', 'seating_area', 'payment_area', 'promotions',
                    'pharmacy_counter', 'bakery_counter', 'deli_counter'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'fresh_produce', 'dairy_section',
                    'meat_section', 'bakery', 'promotions', 'organic_section',
                    'frozen_foods', 'beverage_aisle'
                ],
                product_categories: [
                    'fresh_produce', 'dairy_products', 'meat_seafood', 'bakery_items',
                    'frozen_foods', 'beverages', 'snacks', 'canned_goods', 'household_items',
                    'health_beauty', 'baby_products', 'pet_supplies'
                ]
            },
            'pharmacy': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'consultation_area', 'prescription_counter', 'restroom',
                    'health_screening', 'vaccination_area', 'medical_equipment'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'prescription_area', 'otc_medicines',
                    'beauty_section', 'baby_care', 'consultation_area', 'vitamins',
                    'first_aid', 'personal_care'
                ],
                product_categories: [
                    'prescription_drugs', 'otc_medicines', 'vitamins_supplements', 'beauty_products',
                    'baby_care', 'personal_care', 'medical_equipment', 'first_aid',
                    'health_monitoring', 'dental_care', 'eye_care', 'diabetic_supplies'
                ]
            },
            'furniture': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'design_consultation', 'delivery_desk', 'restroom',
                    'measurement_area', 'fabric_selection', 'custom_order'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'living_room', 'bedroom_section',
                    'dining_room', 'office_furniture', 'outdoor_section', 'clearance',
                    'new_arrivals', 'showroom_area'
                ],
                product_categories: [
                    'living_room_furniture', 'bedroom_furniture', 'dining_room_furniture',
                    'office_furniture', 'outdoor_furniture', 'storage_solutions',
                    'decorative_items', 'lighting', 'rugs_carpets', 'home_textiles',
                    'kitchen_furniture', 'bathroom_furniture'
                ]
            },
            'beauty': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'makeup_counter', 'skincare_consultation', 'restroom',
                    'beauty_treatment', 'product_testing', 'gift_wrapping'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'makeup_section', 'skincare_section',
                    'fragrance_section', 'hair_care', 'promotions', 'new_products',
                    'luxury_brands', 'travel_size'
                ],
                product_categories: [
                    'makeup', 'skincare', 'fragrance', 'hair_care', 'nail_care',
                    'beauty_tools', 'men_grooming', 'organic_products', 'luxury_brands',
                    'travel_size', 'gift_sets', 'beauty_supplements'
                ]
            },
            'sports': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'equipment_consultation', 'fitting_area', 'restroom',
                    'repair_service', 'rental_desk', 'team_orders'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'footwear_section', 'apparel_section',
                    'equipment_section', 'fitness_gear', 'promotions', 'clearance',
                    'new_season', 'team_sports'
                ],
                product_categories: [
                    'footwear', 'apparel', 'fitness_equipment', 'team_sports',
                    'outdoor_gear', 'water_sports', 'winter_sports', 'accessories',
                    'nutrition_supplements', 'sports_medicine', 'camping_gear', 'cycling'
                ]
            },
            'bookstore': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'reading_area', 'cafe_counter', 'restroom',
                    'book_recommendation', 'special_orders', 'gift_wrapping'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'bestsellers', 'new_releases',
                    'fiction_section', 'non_fiction', 'children_books', 'cafe_area',
                    'stationery', 'gift_section'
                ],
                product_categories: [
                    'fiction_books', 'non_fiction', 'children_books', 'educational_books',
                    'stationery', 'gift_items', 'magazines', 'ebooks', 'audiobooks',
                    'art_supplies', 'office_supplies', 'gaming_books'
                ]
            },
            'automotive': {
                stopping_points: [
                    'entrance', 'checkout', 'customer_service', 'information_desk',
                    'service_desk', 'parts_counter', 'restroom',
                    'vehicle_inspection', 'warranty_service', 'custom_orders'
                ],
                high_traffic_areas: [
                    'entrance', 'checkout', 'parts_section', 'accessories_section',
                    'tools_section', 'service_area', 'promotions', 'new_arrivals',
                    'clearance', 'specialty_items'
                ],
                product_categories: [
                    'auto_parts', 'accessories', 'tools_equipment', 'oils_fluids',
                    'tires_wheels', 'electronics', 'interior_accessories', 'exterior_accessories',
                    'maintenance_supplies', 'safety_equipment', 'performance_parts', 'motorcycle_parts'
                ]
            }
        };
        
        // Get current options or use default
        const currentOptions = storeTypeOptions[storeType] || storeTypeOptions['supermarket'];
        
        // Update stopping points
        this.updateCheckboxOptions('stopping_points', currentOptions.stopping_points);
        
        // Update high traffic areas
        this.updateCheckboxOptions('high_traffic_areas', currentOptions.high_traffic_areas);
        
        // Update product categories
        this.updateCheckboxOptions('product_categories', currentOptions.product_categories);
        
        // Options updated, no need to reapply styling
    }
    
    updateCheckboxOptions(fieldName, relevantOptions) {
        const container = document.getElementById(`id_${fieldName}`);
        if (!container) return;
        
        // Get all checkbox options
        const allCheckboxes = container.querySelectorAll('input[type="checkbox"]');
        
        allCheckboxes.forEach(checkbox => {
            const optionValue = checkbox.value;
            const optionDiv = checkbox.closest('div');
            
            if (relevantOptions.includes(optionValue)) {
                // Show relevant options
                optionDiv.style.display = 'flex';
                optionDiv.style.opacity = '1';
            } else {
                // Hide irrelevant options
                optionDiv.style.display = 'none';
                optionDiv.style.opacity = '0';
                checkbox.checked = false; // Uncheck hidden options
            }
        });
        
        // Options updated for store type
    }

    scrollToTop() {
        // Smooth scroll to top of wizard
        const wizardCard = document.querySelector('.wizard-card');
        if (wizardCard) {
            wizardCard.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
    }

    updateStepper(step) {
        document.querySelectorAll('.step-item').forEach((el, index) => {
            const stepNumber = index + 1;
            el.classList.remove('active', 'completed');
            
            if (stepNumber === step) {
                el.classList.add('active');
            } else if (stepNumber < step) {
                el.classList.add('completed');
            }
        });
    }

    updateProgress() {
        const progress = (this.currentStep / this.totalSteps) * 100;
        document.getElementById('progressBar').style.width = `${progress}%`;
        
        const stepNames = [
            'اطلاعات پایه فروشگاه',
            'ساختار فیزیکی',
            'طراحی و دکوراسیون',
            'رفتار مشتری',
            'فروش و محصولات',
            'امنیت و نظارت',
            'اهداف و خروجی'
        ];
        
        document.getElementById('progressText').textContent = 
            `گام ${this.currentStep} از ${this.totalSteps} - ${stepNames[this.currentStep - 1]}`;
    }

    updateNavigation() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        // Show/hide previous button
        prevBtn.style.display = this.currentStep > 1 ? 'block' : 'none';
        
        // Show/hide next/submit buttons
        if (this.currentStep === this.totalSteps) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            // Show emergency submit button in development
            const emergencyBtn = document.getElementById('emergencySubmitBtn');
            if (emergencyBtn) {
                emergencyBtn.style.display = 'block';
            }
        } else {
            nextBtn.style.display = 'block';
            submitBtn.style.display = 'none';
            const emergencyBtn = document.getElementById('emergencySubmitBtn');
            if (emergencyBtn) {
                emergencyBtn.style.display = 'none';
            }
        }
    }

    validateCurrentStep() {
        // For final step, validate all steps
        if (this.currentStep === this.totalSteps) {
            return this.validateAllSteps();
        }
        
        // Validate current step only
        const stepEl = document.querySelector(`[data-step="${this.currentStep}"]`);
        if (!stepEl) {
            console.log('❌ Step element not found for step:', this.currentStep);
        return true;
        }
        
        const requiredFields = stepEl.querySelectorAll('[required]');
        console.log('🔍 Found required fields:', requiredFields.length);
        
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                console.log('❌ Required field empty:', field.name || field.id);
                this.showFieldError(field, 'این فیلد الزامی است');
                isValid = false;
            }
        });
        
        console.log('✅ Step validation result:', isValid);
        return isValid;
    }

    isStepCompleted(stepNumber) {
        // Check if all required fields in the step are filled
        const stepEl = document.querySelector(`[data-step="${stepNumber}"]`);
        if (!stepEl) return false;
        
        const requiredFields = stepEl.querySelectorAll('[required]');
        for (let field of requiredFields) {
            if (!field.value.trim()) {
                return false;
            }
        }
        return true;
    }

    saveData() {
        const formData = new FormData(this.form);
        const data = {};
        
        // Convert FormData to object
        for (let [key, value] of formData.entries()) {
            if (value instanceof File) {
                data[key] = {
                    name: value.name,
                    size: value.size,
                    type: value.type
                };
            } else {
                data[key] = value;
            }
        }
        
        // Save to localStorage (but don't save current step to avoid auto-redirect)
        localStorage.setItem('wizardFormData', JSON.stringify(data));
        // localStorage.setItem('wizardCurrentStep', this.currentStep.toString());
        
        // Show success message
        this.showSaveMessage('اطلاعات ذخیره شد');
    }

    loadSavedData() {
        const savedData = localStorage.getItem('wizardFormData');
        
        if (savedData) {
            try {
                const data = JSON.parse(savedData);
                
                // Restore form data
                Object.keys(data).forEach(key => {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field && !(data[key] instanceof Object)) {
                        if (field.type === 'checkbox') {
                            field.checked = data[key] === 'true';
                        } else if (field.type === 'radio') {
                            const radio = document.querySelector(`[name="${key}"][value="${data[key]}"]`);
                            if (radio) radio.checked = true;
                        } else {
                            field.value = data[key];
                        }
                    }
                });
                
                console.log('📋 Form data restored from localStorage');
            } catch (error) {
                console.error('Error loading saved data:', error);
            }
        }
        
        // Always start from step 1
        this.currentStep = 1;
        this.showStep(1);
        this.updateNavigation();
        this.updateProgress();
        
        console.log('🔄 Starting from step 1');
    }
    
    clearLocalStorage() {
        localStorage.removeItem('wizardFormData');
        localStorage.removeItem('wizardCurrentStep');
        console.log('🗑️ LocalStorage cleared');
    }

    autoSave() {
        // Debounce auto-save
        clearTimeout(this.autoSaveTimeout);
        this.autoSaveTimeout = setTimeout(() => {
            this.saveData();
        }, 2000);
    }

    handleSubmit(e = null) {
        console.log('📤 Form submission started');
        console.log('📊 Current step:', this.currentStep);

        // Only prevent default if we're not on the final step
        if (e && this.currentStep < this.totalSteps) {
            e.preventDefault();
            return false;
        }
        
        // For final step, check all required fields first
        console.log('🚀 Final step - checking all required fields...');
        
        // Check all required fields across all steps
        const allRequiredFields = document.querySelectorAll('input[required], select[required], textarea[required]');
        const missingFields = [];
        
        allRequiredFields.forEach(field => {
            if (field.type === 'checkbox') {
                // For checkboxes, check if at least one is checked
                const checkboxGroup = document.querySelectorAll(`input[name="${field.name}"]`);
                const hasChecked = Array.from(checkboxGroup).some(cb => cb.checked);
                if (!hasChecked) {
                    missingFields.push(field.name);
                }
            } else if (field.type === 'file') {
                // For file inputs, check if file is selected
                if (!field.files || field.files.length === 0) {
                    missingFields.push(field.name || field.id);
                }
            } else if (!field.value || field.value.trim() === '') {
                missingFields.push(field.name || field.id);
            }
        });
        
        if (missingFields.length > 0) {
            console.log('❌ Missing required fields:', missingFields);
            alert(`لطفاً فیلدهای زیر را تکمیل کنید:\n${missingFields.join(', ')}`);
            e.preventDefault();
            return false;
        }
        
        console.log('✅ All required fields are filled');
        
        // Disable HTML5 validation for hidden fields to prevent focus issues
        const allFields = document.querySelectorAll('input, textarea, select');
        allFields.forEach(field => {
            if (field.offsetParent === null) { // Field is hidden
                field.removeAttribute('required');
                field.removeAttribute('pattern');
            }
        });

        // Ensure CSRF token is present before submission
        this.ensureCSRFToken();
        
        console.log('🚀 Form will submit naturally to backend...');

        // Don't prevent default - let the form submit naturally
        // This ensures CSRF token is included automatically
        return true;
    }

    showFieldError(field, message) {
        field.classList.add('is-invalid');
        
        // For container elements (like checkbox containers), add error to the container
        let targetElement = field;
        if (field.id && (field.id.includes('stopping_points') || field.id.includes('high_traffic_areas') || 
                        field.id.includes('product_categories') || field.id.includes('optimization_goals') || 
                        field.id.includes('report_format'))) {
            targetElement = field;
        } else {
            targetElement = field.parentNode;
        }
        
        let errorDiv = targetElement.querySelector('.invalid-feedback');
        if (!errorDiv) {
            errorDiv = document.createElement('div');
            errorDiv.className = 'invalid-feedback';
            errorDiv.style.color = '#dc3545';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.style.marginTop = '0.25rem';
            targetElement.appendChild(errorDiv);
        }
        errorDiv.textContent = message;
    }

    clearFieldError(field) {
        field.classList.remove('is-invalid');
        
        // For container elements, clear error from the container
        let targetElement = field;
        if (field.id && (field.id.includes('stopping_points') || field.id.includes('high_traffic_areas') || 
                        field.id.includes('product_categories') || field.id.includes('optimization_goals') || 
                        field.id.includes('report_format'))) {
            targetElement = field;
        } else {
            targetElement = field.parentNode;
        }
        
        const errorDiv = targetElement.querySelector('.invalid-feedback');
        if (errorDiv) {
            errorDiv.remove();
        }
    }

    showSaveMessage(message) {
        // Create or update save message
        let messageEl = document.getElementById('saveMessage');
        if (!messageEl) {
            messageEl = document.createElement('div');
            messageEl.id = 'saveMessage';
            messageEl.className = 'alert alert-success';
            messageEl.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; min-width: 300px;';
            document.body.appendChild(messageEl);
        }
        
        messageEl.textContent = message;
        messageEl.style.display = 'block';
        
        // Hide after 3 seconds
        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 3000);
    }

    showLoading() {
        const loadingState = document.getElementById('loadingState');
        
        if (loadingState) {
            loadingState.style.display = 'block';
        }
        this.form.style.display = 'none';
        
        // Disable submit button to prevent double submission
        const submitBtn = document.getElementById('nextBtn');
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال ارسال...';
        }
    }

    hideLoading() {
        const loadingState = document.getElementById('loadingState');
        
        if (loadingState) {
            loadingState.style.display = 'none';
        }
        this.form.style.display = 'block';
    }

    showSuccess() {
        const successState = document.getElementById('successState');
        
        if (successState) {
            successState.style.display = 'block';
        }
        this.form.style.display = 'none';
    }

    // Debug buttons removed for production

}

// Global function for removing sales file
function removeSalesFile() {
    const fileInput = document.getElementById('id_sales_file');
    const fileInfo = document.getElementById('salesFileInfo');
    const fileUploadArea = document.getElementById('salesFileUpload');
    
    if (fileInput) fileInput.value = '';
    if (fileInfo) fileInfo.style.display = 'none';
    if (fileUploadArea) fileUploadArea.style.display = 'block';
}

// Global function for removing surveillance file
function removeSurveillanceFile() {
    const fileInput = document.getElementById('id_surveillance_footage');
    const fileInfo = document.getElementById('surveillanceFileInfo');
    const fileUploadArea = document.getElementById('surveillanceFileUpload');
    
    if (fileInput) fileInput.value = '';
    if (fileInfo) fileInfo.style.display = 'none';
    if (fileUploadArea) fileUploadArea.style.display = 'block';
}

// Initialize wizard when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    console.log('🚀 Initializing Clean Wizard...');
    try {
        window.cleanWizard = new CleanWizard();
        console.log('✅ Clean Wizard initialized successfully');
        
        // Make sure CSRF token is available globally
        window.cleanWizard.ensureCSRFToken();
    } catch (error) {
        console.error('❌ Error initializing Clean Wizard:', error);
    }
});
</script>
{% endblock %}