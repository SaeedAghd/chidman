{% extends 'store_analysis/base.html' %}
{% block content %}
<div class="container mt-5">
    <h2>پرداخت</h2>
    {% if retry_after %}
        <div class="alert alert-warning text-center">
            <strong>توجه:</strong> به دلیل تعداد بالای درخواست‌ها، امکان ارسال مجدد تا <span id="retry-seconds">{{ retry_after }}</span> ثانیه دیگر وجود ندارد.<br>
            لطفاً کمی صبر کنید و سپس دوباره تلاش نمایید.
        </div>
        <script>
            var seconds = {{ retry_after }};
            var el = document.getElementById('retry-seconds');
            var timer = setInterval(function() {
                seconds--;
                if (el) el.textContent = seconds;
                if (seconds <= 0) clearInterval(timer);
            }, 1000);
        </script>
    {% elif payment and analysis %}
        <div class="alert alert-success">پرداخت با موفقیت انجام شد.</div>
        <h4>تحلیل اولیه فروشگاه شما:</h4>
        <div class="card mt-3">
            <div class="card-body">
                {% if analysis_summary %}
                    <pre>{{ analysis_summary|safe }}</pre>
                {% else %}
                    <span class="text-danger">تحلیل اولیه در دسترس نیست.</span>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="alert alert-warning">هیچ پرداخت موفقی یافت نشد.</div>
        <form method="post" action="">
            {% csrf_token %}
            <!-- سایر فیلدهای پرداخت (در صورت نیاز) -->
            <button type="submit" class="btn btn-primary">پرداخت</button>
        </form>
    {% endif %}
</div>
{% endblock %}
